<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8" >
<title>100 Prisoners&apos; Strategy</title>
<link rel="stylesheet" href="/css/main.css" media="all">
<style>
html,
head {
    background-color: #aaa;
    font-size: 16px;
    font-family: 'Fira Code', 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
}
body {
    font-size: 1em;
    font-family: inherit;
}
form {
    display: inline;
}
button {
    margin-left: 2px;
}
ul,
li {
    display: inline-block;
}
fieldset {
    display: inline-block;
    border: 1px solid black;
    padding: 3px;
    margin: 5px;
    width: 500px;
}
legend {
    border: 1px solid black;
    padding: 3px;
}
label,
input {
    font-family: inherit;
    display: inline-block;
}
input {
    text-align: right;
}
label {
    width: 130px;
}
input {
    width: 130px;
}
label.check {
    width: 50px;
}
label.check.wide {
    width: 130px;
}
input[type="checkbox"] {
    width: 25px;
}

</style><!--
<s crip t src="https://ajax.googleapis.com/ajax/libs/d3js/3.5.17/d3.min.js" defer async></sc rip t>
<s crip t src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" defer async></sc ri pt>
-->
<script src="js/probability-and-stats.js" defer async></script>
<script src="js/shuffle-5.js" defer async></script>
<script>

var getBoundingBoxPair = function(from,to) {
    let fromItem = document.getElementById(from),
        toItem   = document.getElementById(to),
        fromData = fromItem.getBoundingClientRect(),
        toData   = toItem.getBoundingClientRect(),
        delta    = {
            x:-1*(toData.left - fromData.left),
            y:-1*(toData.top  - fromData.top),
        },
        deltaMinus = {
            x:-1*delta.x,
            y:-1*delta.y,
        },
        fromMid = {
            x:fromData.x - fromData.left + fromData.width/2,
            y:fromData.y -fromData.top + fromData.height/2,
        },
        toMid = {
            x:toData.x - fromData.left + toData.width/2,
            y:toData.y - fromData.top + toData.height/2,
        },
        midDelta = {
            dx:toMid.x - fromMid.x,
            dy:toMid.y - fromMid.y,
        },
        x1 = (fromMid.x).toFixed(3),
        y1 = (fromMid.y).toFixed(3),
        x2 = (toMid.x).toFixed(3),
        y2 = (toMid.y).toFixed(3),
        path=`M${x1}, ${y1} C${x2} ${y1} ${x1} ${y2} ${x2} ${y2}`;
        return {
            fromData:fromData,
            toData:toData,
            delta:delta,
            deltaMinus:deltaMinus,
            fromMid:fromMid,
            toMid:toMid,
            midDelta:midDelta,
            path:path,
            x1:x1,
            y1:y1,
            x2:x2,
            y2:y2,
        };
}

if (false) {
    item=document.getElementById("pris0");
    itemlast = document.getElementById("pris9");
    first = itemlast.getBoundingClientRect();
    last = item.getBoundingClientRect();
    delta = {x:-1*(last.left - first.left), y:-1*(last.top-first.top),}
    itemlast.style.transform=`translate(-${delta.x}px,-${delta.y}px)`;
    item.style.transform=`translate(${delta.x}px,${delta.y}px)`
}

</script>

</head>
<body>
<div id="controls">
<form id="form1"
    action=""
    method="GET"
    oninput="rows.value=Math.ceil(parseInt(gSize.value)/parseInt(cols.value))"
    onSubmit="() => {return false;}">
<fieldset id="fs1">
<ul id="ul1">
<li>
    <label for="gSize">Prisoners</label>
    <input id="gSize" name="gSize" value="10" type="number" min="1" step="1" >
</li>
<li>
    <label for="cols">Columns</label>
    <input id="cols" name="cols" value="5" type="number" min="1" step="1" >
</li>
<li>
    <label>Rows</label><output id="rows" name="rows" form="form1" ></output>
</li>
</ul>
<ul id="ul2">
<li>
    <input type="button" value="Setup File Boxes" onClick="myPrisonerSearch.setupGrid('file-box-room');">
</li>
<li>
    <input type="button" value="Run Strategy" onClick="initFollowNumbers('form1');">
</li>
</ul>
</fieldset>
</form>
</div>
<div id="file-box-room">
    <p>ooo</p>
</div>
<div id="ideasAndCommentary" >
<li>
    intro first show how to sort 100 items in only 100 operations.
</li>
</div>
<style id="form-grid-style">
#controls {
    display:grid;
    font-size: 3em;
    gap: 10px;
    grid-auto-rows: minmax(100px, auto);
    grid-auto-columns: 100px;
}
#ul1 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-columns: repeat(3, auto);
    padding-inline-start: 0;
}
#ul2 {
    display: grid;
    grid-template-columns: repeat(2, auto);
    padding-inline-start: 0;
}
#ul1 > li,
#ul2 > li {
    display: grid;
    grid-template-columns: auto;
}
#ul1 input,
#ul1 output,
#ul2 input {
    font-size: inherit;
    text-align: right;
    width: 9ch;
}

#ul1 output {
    background-color: #eee;
    padding-right: .5ch;
    border: 1px inset #222;
    border-radius: .05em;
    font-size: 1.05em;
}

#ul2 input[type="button"] {
    width: auto;
    display: inline;
    margin: auto;
}
</style>
<style id="file-box-style">

#file-box-room #anchor,
#file-box-room #row-heads,
#file-box-room #col-heads,
#file-box-room #data-grid  {
    display:grid;
    border: 0.5px solid rgba(255,0,0,.5);
    gap: 10px;
}
#file-box-room div.data {
    height: 100px;
    width: 100px;
    border: 1px solid rgba(0,0,0,.5);
    text-align:center;
    vertical-align:middle;
    border-radius: 10px; 
    line-height: 2em;
}
</style>
<style id="dynamic-grid-style">
#file-box-room {
    display: grid;
}

#file-box-room #anchor div,
#file-box-room #col-heads div,
#file-box-room #row-heads div,
#file-box-room #data-grid div {
    height: 100px;
    width: 100px;
    border: 1px solid rgba(0,0,0,.5);
    text-align: center;
    vertical-align: middle;
    border-radius: 10px;
    line-height: 2em;
    font-size: 3em;
}
#file-box-room #data-grid div.row-col {
    border: 1px solid rgba(0,0,0,0.01);
    color: rgba(0,0,0,0.01);
    font-size: 2px;
    text-align: center;
    vertical-align: middle;
}
</style>
<style id="dynamic-box-style">
</style>
<script>

class PageState {
    config;
    params;
    url;
    forms;
    formIdMap = new Map();
    constructor(state={}) {
        if (state.url) {
            this.url = state.url;
        } else {
            this.url = new URL(window.location.href);
        }
        if (state.params) {
            this.params = state.params;
        } else {
            this.params = new URLSearchParams(this.url.search);
        }
        if (state.forms) {
            this.forms = state.forms;
        } else {
            this.forms = document.forms;
        }
        this.mapIds(this.formIdMap,this.forms);
        if (state.config) {
            this.config = state.config;
            this.sync(this.config,"url2form")
        }
        if (state.events) {
            for (let i=0,data;i<state.events.length;i++) {
                data = state.events[i];
                const evt = new Event(...data.desc);
                document.getElementById(data.target).dispatchEvent(evt);
            }
        }
    }
    get search() {
        return this.url.search;
    }
    mapIds(map,iterable) {
        for (let i=0;i<iterable.length;i++) {
            map.set(iterable[i].id,i);
        }
    }
    param(which) {
        let value;
        if (this.params.has(which)) {
            value = this.params.get(which);
        } 
        return value;
    }
    setParam(which,value) {
        if (!this.params.has(which)) {
            console.log(`setParam adding ${which} with value ${value}`);
        }
        this.params.set(which,value);
        return value;
    }
    formCount() {
        return this.forms.length;
    }
    getForm(index) {
        if (this.forms.length > index) {
            return this.forms[index]
        } 
    }
    sync(config,mode="url2form") {
        let map = config.map,
            len = map.length;
        mode = mode?mode:config.mode;

        switch (mode) {
        case "form2url":
            for (let i=0;i<len;i++) {
                let mapping = map[i],
                    form = this.forms[this.formIdMap.get(mapping.form)];
                this.setParam(mapping.urlvar,form.elements[mapping.formvar].value);
            }
            break;
        case "url2form":
        default:
            for (let i=0;i<len;i++) {
                let mapping = map[i],
                    form = this.forms[this.formIdMap.get(mapping.form)],
                    val = this.param(mapping.urlvar);
                form.elements[mapping.formvar].value = val?val:mapping.default;
            }
            break;
        }
    }
}



var pState,
    myVis,
    myPrisonerSearch;

class Visualization {
    static #idCounter = 0;
    name;
    state;
    constructor(conf={
        tmpl:"vis",
        state:null,
    }) {
        this.setName(conf.tmpl);
        this.state = conf.state;
    }
    setName(tmpl="vis") {
        this.name = `${tmpl}-${Visualization.#idCounter++}`;
        return this.name;
    }
}

class PrisonerSearch extends Visualization {
    numPrisoners;
    numColumns;
    superGrid={
        anchor:{id:"anchor",class:"anchor-grid"},
        rowHeads:{id:"row-heads",class:"row-grid"},
        colHeads:{id:"col-heads",class:"col-grid"},
        dataGrid:{id:"data-grid",class:"data-grid"},
        anchorLabel:(text => text),
        colLabel:(col => col),
        rowLabel:(row => row),
        dataVals:((col,row) => {return row*10+col}),
    };
    constructor(state) {
        super({
            tmpl:"PrisonerSearch",
            state:state,
        });
        this.updateState();
    }
    updateState() {
        this.numPrisoners = this.state.param("gs");
        this.numColumns   = this.state.param("cols");
    }
    sync(mode="form2url") {
        this.state.sync(this.state.config,mode);
        this.updateState();
    }
    setupSuperGrid(parentId,sgConfig=null) {
        sgConfig = sgConfig?sgConfig:this.superGrid;
        let parent = document.getElementById(parentId),
            cols = parseInt(this.numColumns),
            rows = parseInt(Math.ceil(this.numPrisoners/cols)),
            dataWidth=120*cols,
            dataHeight=120*rows,
            width = (cols+1)*120,
            height = (rows+1)*120,
            anchor,
            child,
            rowHead,
            colHead,
            dataGrid;

        parent.innerHTML="";
        parent.setAttribute("style",`grid-template-columns:1fr ${cols}fr; grid-template-rows:1fr ${rows}fr;height:${height}px;width:${width}px;`);

        if (sgConfig.anchor) {
            anchor = document.createElement("div");
            anchor.setAttribute("id",sgConfig.anchor.id);
            anchor.setAttribute("class",sgConfig.anchor.class);
            anchor.setAttribute("style",`grid-column: 1 / 1;grid-row: 1 / 1;`)
            child = parent.appendChild(anchor);
            child.innerHTML = "";
        }
        if (sgConfig.colHeads) {
            colHead = document.createElement("div");
            colHead.setAttribute("id",sgConfig.colHeads.id);
            colHead.setAttribute("class",sgConfig.colHeads.class);
            colHead.setAttribute("style",`grid-column: 2 / 2;grid-row: 1 / 1;`);
            child = parent.appendChild(colHead);
            child.innerHTML = "";
        }
        if (sgConfig.rowHeads) {
            rowHead = document.createElement("div");
            rowHead.setAttribute("id",sgConfig.rowHeads.id);
            rowHead.setAttribute("class",sgConfig.rowHeads.class);
            rowHead.setAttribute("style",`grid-column: 1 / 1;grid-row: 2 / 2;`);
            child = parent.appendChild(rowHead);
            child.innerHTML = "";
        }
        if (sgConfig.dataGrid) {
            dataGrid = document.createElement("div");
            dataGrid.setAttribute("id",sgConfig.dataGrid.id);
            dataGrid.setAttribute("class",sgConfig.dataGrid.class);
            child = parent.appendChild(dataGrid);
            child.innerHTML = ""
            let svgTemplate = this.getPageTemplate("#svg-starter-doc");
            if (svgTemplate) {
                svgTemplate.setAttribute("style",`grid-column: 1 / ${cols+1};grid-row: 1 / ${rows+1};z-index: -2;`);
                svgTemplate.setAttribute("height",dataHeight);
                svgTemplate.setAttribute("width",dataWidth);
                child.appendChild(svgTemplate);
            }
        }
        this.superGrid = sgConfig;
        return this.superGrid;
    }
    getPageTemplate(selector) {
        let docFragment = null,
            firstElementChild = null,
            clone = "";
        if ('content' in document.createElement('template')) {
            docFragment = document.querySelector(selector);
            firstElementChild = docFragment.content.firstElementChild;
            clone = firstElementChild.cloneNode(true);
        } 
        return clone;
    }
    setupGrid(parentId,sgConfig=null) {
        this.sync();

        sgConfig = this.setupSuperGrid(parentId,sgConfig);

        let anchorId   = sgConfig.anchor.id,
            dataGridId = sgConfig.dataGrid.id,
            colGridId  = sgConfig.colHeads.id,
            rowGridId  = sgConfig.rowHeads.id,
            parent     = document.getElementById(dataGridId),
            anchor     = document.getElementById(anchorId),
            cHead      = document.getElementById(colGridId),
            rHead      = document.getElementById(rowGridId),
            cols       = this.numColumns,
            rows       = Math.ceil(this.numPrisoners/cols),
            anchorHead = document.createElement("div"),
            aContent   = document.createTextNode(this.superGrid.anchorLabel("0"));
            anchorHead.setAttribute("id","atext");
            anchorHead.setAttribute("style",`grid-column: 1 / 1;grid-row:1 / 1;`)
            anchorHead.appendChild(aContent);
            anchor.appendChild(anchorHead);



        for (let row=0,index=0;row<rows;row++) {
            let rowHead = document.createElement("div");
            rowHead.setAttribute("id",`row-${row+1}`);
            rowHead.setAttribute("style",`grid-row: ${row+1} / ${row+1}; grid-column: 1 / 1;`)
            let content = document.createTextNode(this.superGrid.rowLabel(row+1));
            rowHead.appendChild(content);
            rHead.appendChild(rowHead);

            for (let col=0;col<cols&&index<this.numPrisoners;col++,index++) {
                if (row==0) {
                    let colHead = document.createElement("div");
                    colHead.setAttribute("id",`col-${col+1}`);
                    colHead.setAttribute("style",`grid-row: 1 / 1;grid-column: ${col+1} / ${col+1};`)
                    let content = document.createTextNode(this.superGrid.colLabel(col+1));
                    colHead.appendChild(content);
                    cHead.appendChild(colHead);
                }
                // first div holds fixed position/coords: (x,y) = (2,3)
                const fileBox = document.createElement("div");
                const content = document.createTextNode(`(${col},${row})`);
                fileBox.setAttribute("id",`c${col}r${row}`);
                fileBox.setAttribute("class",`row-col col${col} row${row}`);
                fileBox.setAttribute("style",`z-index:-1; grid-column: ${col+1} / ${col+1};grid-row: ${row+1} / ${row+1};`);
                fileBox.appendChild(content);
                parent.appendChild(fileBox);
                {
                    // visible and moveable content div
                    const fileBox = document.createElement("div");
                    const content = document.createTextNode(`${index+1}`);
                    fileBox.setAttribute("id",`pris${index}`);
                    fileBox.setAttribute("class",`data col${col} row${row}`);
                    fileBox.setAttribute("style",`grid-column: ${col+1} / ${col+1};grid-row: ${row+1} / ${row+1};`);
                    fileBox.appendChild(content);
                    parent.appendChild(fileBox);
                }
            }
        }
    }
    setupRowColLabels(parentId,labels={}) {

    }
    saveState(mode="form2url") {
        this.state.sync(this.state,mode);
        this.updateState();
    }
}

var config = {
    mode: "url2form",
    map: [
        {
            urlvar:"gs",
            default:10,
            form:"form1",
            formvar:"gSize",
            param:"numPrisoners",
        },
        {
            urlvar:"cols",
            default:5,
            form:"form1",
            formvar:"cols",
            param:"numColumns",
        },
    ],
}

window.addEventListener('DOMContentLoaded', () => {
    // The current state of url and form is gathered here:
    pState = new PageState({
        config: config,
        events: [{target:"form1",desc:["input",{"bubbles":true, "cancelable":false}]}]
    });
    
    myPrisonerSearch = new PrisonerSearch(pState);

}); 
</script>
<style>
#pris0 {
    offset-path: path("M51.000, 51.000 C173.500 51.000 51.000 295.000 173.500 295.000");
    offset-path: path("M51.000, 51.000 C418.500 51.000 51.000 539.000 418.500 539.000");
    offset-path: path("M51.000, 51.000 C418.500 51.000 51.000 295.000 418.500 295.000");
    animation: move 3000ms 4 ease-in-out; 
    animation-fill-mode:forwards;
    animation-direction:alternate
}
#pris2 {
    offset-path: path("M51.000, 51.000 C173.500 51.000 51.000 295.000 173.500 295.000");
    offset-path: path("M51.000, 51.000 C418.500 51.000 51.000 539.000 418.500 539.000");
    offset-path: path("M51.000, 51.000 C418.500 51.000 51.000 295.000 418.500 295.000");
    offset-path: path("M51.000, 51.000 C173.500 51.000 51.000 51.000 173.500 51.000");
    animation: move 3000ms 4 ease-in-out; 
    animation-fill-mode:forwards;
    animation-direction:alternate
}
#pris3 {
    offset-path: path("M51.000, 51.000 C-316.500 51.000 51.000 -437.000 -316.500 -437.000");
    offset-path: path("M51.000, 51.000 C-71.500 51.000 51.000 51.000 -71.500 51.000");
    animation: move 3000ms 3 ease-in-out;
    animation: move-and-rotate 3000ms 4 alternate forwards ease-in-out;
    animation-fill-mode: forwards;
    animation-direction: alternate;
}
#pris4 {
    offset-path: path("M51.000, 51.000 C173.500 51.000 51.000 295.000 173.500 295.000");
    animation: move 3000ms 4 ease-in-out; 
    animation-fill-mode:forwards;
    animation-direction:alternate
}
#pris13 {
    offset-path: path("M51.000, 51.000 C-71.500 51.000 51.000 -193.000 -71.500 -193.000");
    animation: move 3000ms 3 ease-in-out;
    animation: move-and-rotate 3000ms 4 alternate forwards ease-in-out;
    animation-fill-mode: forwards;
    animation-direction: alternate;
}
#pris19-disable {
    offset-path: path("M51.000, 51.000 C-316.500 51.000 51.000 -437.000 -316.500 -437.000");
    animation: move 3000ms 3 ease-in-out;
    animation: move-and-rotate 3000ms 4 alternate forwards ease-in-out;
    animation-fill-mode: forwards;
    animation-direction: alternate;
}

#pris16 {
    offset-path: path("M51.000, 51.000 C173.500 51.000 51.000 295.000 173.500 295.000");
    offset-path: path("M51.000, 51.000 C418.500 51.000 51.000 -193.000 418.500 -193.000");
    offset-path: path("M51.000, 51.000 C418.500 51.000 51.000 -71.000 418.500 -71.000");
    animation: move 3000ms 4 ease-in-out; 
    animation-fill-mode:forwards;
    animation-direction:alternate
}
#pris15 {
    offset-path: path("M51.000, 51.000 C-316.500 51.000 51.000 295.000 -316.500 295.000");
    offset-path: path("M51.000, 51.000 C-316.500 51.000 51.000 -193.000 -316.500 -193.000");
    offset-path: path("M51.000, 51.000 C-316.500 51.000 51.000 173.000 -316.500 173.000");
    animation: move 3000ms 3 ease-in-out;
    animation: move-and-rotate 3000ms 4 alternate forwards ease-in-out;
    animation-fill-mode: forwards;
    animation-direction: alternate;
}
#pris11 {
    offset-path: path("M51.000, 51.000 C-316.500 51.000 51.000 295.000 -316.500 295.000");
    offset-path: path("M51.000, 51.000 C-316.500 51.000 51.000 -193.000 -316.500 -193.000");
    animation: move 3000ms 3 ease-in-out;
    animation: move-and-rotate 3000ms 4 alternate forwards ease-in-out;
    animation-fill-mode: forwards;
    animation-direction: alternate;
}

@keyframes move {
  0% {
    offset-distance: 0%;
  }
  100% {
    offset-distance: 100%;
  }
}
@keyframes move-and-rotate {
  0% {
    offset-distance: 0%;
    transform: rotate(180deg);
  }
  100% {
    offset-distance: 100%;
    transform: rotate(180deg);
  }
}
</style>
<!-- reuseable template for svg doc-->
<!-- https://developer.mozilla.org/en-US/docs/Web/HTML/Element/template -->
<template id="svg-template" type="image/svg+xml"><svg
    id="svgtmp"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    x="0"
    y="0"
    width="100%"
    height="100%"
    >
<style id="svg-styles">
svg#svgtmp {
    fill:transparent;
    background-color:transparent;
    stroke:white;
    stroke-width:2;
}
svg g#main rect#bg,
svg g#main ellipse#ellipse1 {
    fill: transparent;
    background-color: transparent;
    stroke: white;
    stroke-width: 2;
}
#path3 {
    stroke: yellow;
    stroke-width:2;
}
#path4 {
    stroke: cyan;
    stroke-width:2;
}
#path1 {
    stroke: purple;
    stroke-width:2;
}
#item {
    width: 100;
    height: 100;
    stroke: black;
    stroke-width: 1;
    fill: transparent;
}
</style>
<defs id="defs">
    <!-- examples of path defs -->
<path id="path1" transform="translate(244,0)" d="M51.000, 51.000 C173.500 51.000 51.000 51.000 173.500 51.000"/>
<path id="path2" transform="translate(0,122.5)" d="M51.000, 51.000 C173.500 51.000 51.000 295.000 173.500 295.000"/>
<path id="path3" d="M51.000, 51.000 C418.500 51.000 51.000 295.000 418.500 295.000"/>
<path id="path4" transform="translate(0,488)" d="M51.000, 51.000 C418.500 51.000 51.000 -71.000 418.500 -71.000"/>
<ellipse transform="translate(50%,50%)" id="ellipse1" cx="50%" cy="50%" rx="50%" ry="50%"/>

<rect id="item" x="0" y="0" height="100" width="100" />

</defs>
<rect id="bg" x="0" y="0" height="100%" width="100%" />
<g id="file-box-room" x="0" y="0" transform="translate(0,0)">
<g id="anchor" class="anchor-grid" x="0" y="0" >

</g>
<g id="col-heads" class="col-grid" x="0" y="0" transform="translate(120,0)">

</g>
<g id="row-heads" class="row-grid" x="0" y="0" transform="translate(0,120)">

</g>
<g id="data-grid" class="data-grid"  x="0" y="0" transform="translate(120,120)">

</g>
</g>
</svg></template>

</body>
</html>