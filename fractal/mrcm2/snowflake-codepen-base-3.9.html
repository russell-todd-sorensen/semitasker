<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8" >
<title>SnowFlake CPC Challenge</title>
<style>
#no-hide {
    display: inline-block;
    vertical-align:top;
}
#control-container {
    display: inline-block;
    vertical-align:top;
}
#controls li {
    list-style-type:none;
}
#controls ul {
  display: flex;
  flex-flow: row wrap;
}
 form#controls {
  display: flex;
  flex-flow: row wrap;
}

/* from svg doc */

#dashed-pos-boundary {
    stroke-width: 1;
    stroke-dasharray: 5 2; 
    stroke: tan;
    fill: none;
}
#svg defs use[href="#c1"]:nth-of-type(1) {
    fill:rgba(255,165,0,0.7);
}
#svg use[href="#c1"]:nth-of-type(2) {
    fill:rgba(89,0,255,0.7);
}
#svg use[href="#c1"]:nth-of-type(3) {
    fill:rgba(255,0,89,0.7);
}
#svg use[href="#c1"]:nth-of-type(4) {
    fill:rgba(165,255,89,0.7);
}

#svg defs use.g0:nth-of-type(1) {
    fill:rgba(255,165,0,0.7);
}
#svg defs use.g0:nth-of-type(2) {
    fill:rgba(89,0,255,0.7);
}
#svg defs use.g0:nth-of-type(3) {
    fill:rgba(255,0,89,0.7);
}
#svg defs use.g0:nth-of-type(4) {
    fill:rgba(165,255,89,0.7);
}

#svg use[href="#g0"]:nth-of-type(1) {
    fill:rgba(65,65,65,0.7);
}
#svg use[href="#g1"]:nth-of-type(3) {
    fill:rgba(255, 0, 89,0.7);
}
#svg use[href="#g1"]:nth-of-type(2) {
    fill:rgba(165, 165, 218,0.7);
}
#svg use[href="#g4"]:nth-of-type(4) {
    fill:rgba(89,255,0,0.7);
}
#svg use[href="#g4"]:nth-of-type(1) {
    fill:rgba(165,165,89,0.7);
}
#svg use#show[href="#g6"]:nth-of-type(1) {
    fill:rgba(165, 165, 218,0.7);
}
/*
#svg defs circle.primitive,
#svg defs rect.primitive,
#svg defs path.primitive */
#composition-table use#show 
{
    fill:rgba(255,165,0,0.7);
}
</style>
</head>
<body>
<div id="no-hide">
 <svg id="svg" x="0" y="0" height="642" width="642" viewBox="0 0 642 642">
<defs>
<circle id="c1" class="primitive" x="0" y="0" cx="320" cy="320" r="300" />
<rect id="r1" class="primitive" x="20" y="20" height="600" width="600" />
<path id="p1" class="primitive" x="0" y="0" d="M 20 20 h 600 L 321 622 Z" />
<path id="p2" class="primitive" x="0" y="0" d="M 0 14.47 h 642 L 321 627.53 Z" />
<g id="g0">
    <use href="#c1" class="g0" transform="matrix(0.37 0.642 -0.642 0.37 406.7840 -3.9040)"/>
    <use href="#c1" class="g0" transform="matrix(0.255 0 0 0.255 238.464 429.696)"/>
    <use href="#c1" class="g0" transform="matrix(0.255 0 0 0.255 73.344 142.848)"/>
    <use href="#c1" class="g0" transform="matrix(0.255 0 0 0.255 403.5840 142.848)"/>
</g>
<g id="g1">
    <use href="#g0" class="g1" transform="matrix(0.37 0.642 -0.642 0.37 406.7840 -3.9040)"/>
    <use href="#g0" class="g1" transform="matrix(0.255 0 0 0.255 238.464 429.696)"/>
    <use href="#g0" class="g1" transform="matrix(0.255 0 0 0.255 73.344 142.848)"/>
    <use href="#g0" class="g1" transform="matrix(0.255 0 0 0.255 403.5840 142.848)"/>
</g>
<g id="g2">
    <use href="#g1" class="g2" transform="matrix(0.37 0.642 -0.642 0.37 406.7840 -3.9040)"/>
    <use href="#g1" class="g2" transform="matrix(0.255 0 0 0.255 238.464 429.696)"/>
    <use href="#g1" class="g2" transform="matrix(0.255 0 0 0.255 73.344 142.848)"/>
    <use href="#g1" class="g2" transform="matrix(0.255 0 0 0.255 403.5840 142.848)"/>
</g>
<g id="g3">
    <use href="#g2" class="g3" transform="matrix(0.37 0.642 -0.642 0.37 406.7840 -3.9040)"/>
    <use href="#g2" class="g3" transform="matrix(0.255 0 0 0.255 238.464 429.696)"/>
    <use href="#g2" class="g3" transform="matrix(0.255 0 0 0.255 73.344 142.848)"/>
    <use href="#g2" class="g3" transform="matrix(0.255 0 0 0.255 403.5840 142.848)"/>
</g>
<g id="g4">
    <use href="#g3" class="g4" transform="matrix(0.37 0.642 -0.642 0.37 406.7840 -3.9040)"/>
    <use href="#g3" class="g4" transform="matrix(0.255 0 0 0.255 238.464 429.696)"/>
    <use href="#g3" class="g4" transform="matrix(0.255 0 0 0.255 73.344 142.848)"/>
    <use href="#g3" class="g5" transform="matrix(0.255 0 0 0.255 403.5840 142.848)"/>
</g>
<g id="g5">
    <use href="#g4" class="g5" transform="matrix(0.37 0.642 -0.642 0.37 406.7840 -3.9040)"/>
    <use href="#g4" class="g5" transform="matrix(0.255 0 0 0.255 238.464 429.696)"/>
    <use href="#g4" class="g5" transform="matrix(0.255 0 0 0.255 73.344 142.848)"/>
    <use href="#g4" class="g5" transform="matrix(0.255 0 0 0.255 403.5840 142.848)"/>
</g>
<g id="g6">
    <use href="#g5" class="g6" transform="matrix(0.37 0.642 -0.642 0.37 406.7840 -3.9040)"/>
    <use href="#g5" class="g6" transform="matrix(0.255 0 0 0.255 238.464 429.696)"/>
    <use href="#g5" class="g6" transform="matrix(0.255 0 0 0.255 73.344 142.848)"/>
    <use href="#g5" class="g6" transform="matrix(0.255 0 0 0.255 403.5840 142.848)"/>
</g>
<g id="euclidian-transform-xy-plane">
    <path id="dashed-pos-boundary" d="M 0 640 h 640 v -640"/>
    <line y1="0" x1="-100%" x2="100%" y2="0" stroke="black" stroke-width="1"/>
    <line x1="0" y1="-100%" y2="100%" x2="0" stroke="black" stroke-width="1"/>
</g>
</defs>
<use href="#euclidian-transform-xy-plane" />

<g id="composition-table">
    <use id="show" href="#g6" transform="scale(1.0)"/>
</g>
</svg>
</div>
<div id="control-container">
<form id="controls" onSubmit="() => {return false}" >
<ul>
<fieldset>
  <legend>Primitive</legend>
<li><input type="radio" name="prim" id="prim-c1" value="c1"
    onClick="selectPrim('g0','c1')" checked>Circle 1</li>
<li><input type="radio" name="prim" id="prim-p7" value="p7"
    onClick="selectPrim('g0','p7')" >Triangle P7</li>
<li><input type="radio" name="prim" id="prim-p10" value="p10"
    onClick="selectPrim('g0','p10')" >Triangle p10</li>
<li><input type="radio" name="prim" id="prim-p20" value="p20" checked
    onClick="selectPrim('g0','p20')" >Triangle p20</li>
<li><input type="radio" name="prim" id="prim-sq2" value="sq2"
    onClick="selectPrim('g0','sq2')" >Square sq2</li>
<li><input type="radio" name="prim" id="prim-pent1" value="pentagon1"
    onClick="selectPrim('g0','pentagon1')" >Pentagon pent1</li>
<li><input type="radio" name="prim" id="prim-hex3" value="hex3"
    onClick="selectPrim('g0','hex3')" >Hexagon hex3</li>
<li><input type="radio" name="prim" id="prim-hex2" value="hex2"
    onClick="selectPrim('g0','hex2')" >Hexagon hex2</li>
<li><input type="radio" name="prim" id="prim-ng1" value="nonagon1"
    onClick="selectPrim('g0','nonagon1')" >Nonagon 1</li>
<li><input type="radio" name="prim" id="prim-ng2" value="nonagon2"
    onClick="selectPrim('g0','nonagon2')" >Nonagon 2</li>
<li><input type="radio" name="prim" id="prim-dd1" value="dodecagon1"
    onClick="selectPrim('g0','dodecagon1')" >Dodecagon 1</li>
</fieldset>
</ul>
<ul>
<fieldset>
  <legend>Top Group</legend>
<li><input type="radio" name="group" id="group-g6" value="g6" checked  onClick="selectGroup('show','g6')">Group 6</li>
<li><input type="radio" name="group" id="group-g5" value="g5" onClick="selectGroup('show','g5')">Group 5</li>
<li><input type="radio" name="group" id="group-g4" value="g4" onClick="selectGroup('show','g4')">Group 4</li>
<li><input type="radio" name="group" id="group-g3" value="g3" onClick="selectGroup('show','g3')" checked>Group 3</li>
<li><input type="radio" name="group" id="group-g2" value="g2" onClick="selectGroup('show','g2')">Group 2</li>
<li><input type="radio" name="group" id="group-g1" value="g1" onClick="selectGroup('show','g1')">Group 1</li>
<li><input type="radio" name="group" id="group-g0" value="g0" onClick="selectGroup('show','g0')">Group 0</li>
<li><input type="radio" name="group" id="group-c1" value="c1" onClick="selectTopPrim('show')">Primitive</li>
</fieldset>
</ul>
</form>
</div>
<script>
var selectGroup = function (useId,groupId) {
    let useElement = document.getElementById(useId);
    useElement.setAttribute("href",`#${groupId}`);
}
var selectPrim = function (useClass,primId) {
    let useElements = document.getElementsByClassName(useClass);
    for (let i=0;i<useElements.length;i++) {
        let useElement = useElements[i];
        useElement.setAttribute("href",`#${primId}`);
    }
}
var selectTopPrim = function(useId,
    selector="form#controls input[name='prim']:checked") {
    let primId = document.querySelector(selector).value;
    selectGroup(useId,primId);
}
var drawCenteredPolygon = function(configTmpl) {
    const NS_URI = 'http://www.w3.org/2000/svg';
    let config = Object.assign({
        // if cicle exists following will use current dims
        radius:300,
        x:0,
        y:0,
        cx:320,
        cy:320,
        sides:3,
        startAngle:0,               //3 O'clock Give angle in degrees
        vertexOrder:1,              //increasing/clockwise, decreasing/ccw:-1
        inscribed:true,             //true => polygon drawn inside circle
        svgQuerySelector:"#svg1",   //svg doc must exist
        circleId: "p0",             // makes circle in '#svg1 defs ' if it doesn't exist
        pathId: "p1",
        pathClass: "primitive",
        fillRule:"evenodd",
        destroyCircle:false,
    },configTmpl);
    console.log(`Making ${config.inscribed?"in":"circum"}scribed polygon with ${config.sides} sides of radius ${config.radius}.`)
    
    let svgDoc  = document.querySelector(config.svgQuerySelector),
        svgDefs = document.querySelector("defs"),
        circle  = svgDefs.querySelector(`defs circle#${config.circleId}`),
        path    = svgDefs.querySelector(`defs path#${config.pathId}`);

    if (circle == null) {
        circle = document.createElementNS(NS_URI,"circle");
        circle.setAttribute("id",config.circleId);
        circle.setAttribute("x",config.x);
        circle.setAttribute("y",config.y);
        circle.setAttribute("cx",config.cx);
        circle.setAttribute("cy",config.cy);
        circle.setAttribute("r",config.radius);
        svgDefs.appendChild(circle);
    } else {
        console.log(`Using existing dimensions of circleId=${config.circleId}.`);
        config.x = circle.getAttribute("x");
        config.y = circle.getAttribute("y");
        config.cx = circle.getAttribute("cx");
        config.cy = circle.getAttribute("cy");
        config.radius = circle.getAttribute("r");
    }

    let circleLength = circle.getTotalLength(),
        start0       = circle.getPointAtLength(0),
        startPoint   = config.startAngle==0?start0:circle.getPointAtLength(config.startAngle/(360)*circleLength);
        verts        = [],
        startPct     = ((config.startAngle%360)/360);
    
    for (let i=0;i<config.sides;i++) {
        let length = (startPct + i/config.sides)*circleLength;
        if (length > circleLength) {
            length -= circleLength;
        }
        verts[i] = circle.getPointAtLength(length);
    }

    console.log(`Total Circle Length=${circleLength} Point at startingAngle ${config.startAngle}: x=${startPoint.x} y=${startPoint.y}`);

    if (config.destroyCircle && circle) {
        circle.remove();
    }

    // write the path description
    let pathDescr = `M ${verts[0].x},${verts[0].y} `;
    for (let i=1;i<verts.length;i++) {
        vert = verts[i];
        pathDescr = pathDescr + `L ${vert.x},${vert.y} `
    }
    pathDescr += "Z";
    if (path == null) {
        path = document.createElementNS(NS_URI,"path");
        path.setAttribute("id",config.pathId);
        path.setAttribute("class",config.pathClass);
        path.setAttribute("d",pathDescr);
        svgDefs.appendChild(path);
    } else {
        path.setAttribute("d",pathDescr);
    }
    return {verts:verts,d:pathDescr}
}

window.addEventListener('DOMContentLoaded', () => {
    drawCenteredPolygon({svgQuerySelector:"#svg",circleId:"t7",pathId:"p7",startAngle:0});
    drawCenteredPolygon({svgQuerySelector:"#svg",circleId:"s10",pathId:"p10",startAngle:15});
    drawCenteredPolygon({svgQuerySelector:"#svg",sides:3,circleId:"s20",pathId:"p20",startAngle:90});
    drawCenteredPolygon({svgQuerySelector:"#svg",sides:4,circleId:"s22",pathId:"sq2",startAngle:0});
    drawCenteredPolygon({svgQuerySelector:"#svg",sides:6,circleId:"s43",pathId:"hex3",startAngle:0});
    drawCenteredPolygon({svgQuerySelector:"#svg",sides:6,circleId:"s44",pathId:"hex2",startAngle:30});
    drawCenteredPolygon({svgQuerySelector:"#svg",sides:9,circleId:"s53",pathId:"nonagon1",startAngle:15});
    drawCenteredPolygon({svgQuerySelector:"#svg",sides:9,circleId:"s54",pathId:"nonagon2",startAngle:0});
    drawCenteredPolygon({svgQuerySelector:"#svg",sides:5,circleId:"s55",pathId:"pentagon1",startAngle:30});
    drawCenteredPolygon({svgQuerySelector:"#svg",sides:12,circleId:"s56",pathId:"dodecagon1",startAngle:0});

    selectPrim('g0','p20');
    selectGroup('show','g3');
});
</script>
</body>
</html>