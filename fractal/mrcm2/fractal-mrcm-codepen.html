<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">

<title>The Chaos Game: How Randomness Creates Deterministic Shapes</title>
<style>

body,
html {
  font-family:"Lucida Console", Monaco, monospace;
  background-color: white;
  margin:0;
  padding:0;
  border:0;
}

#composite {
    position: relative;
    width: 80%;
}

#svg2 {
    position: absolute;
    top: 15.5px;
    left: 30.5px;
}

#main,
#main2 {
    position: relative;
    border: 3px solid black;
    display: inline-block;
}

#myCanvas,
#myCanvas2 {
    border: 1px solid #444;
    margin-top: 15px;
    margin-left: 30px;
    background-clip:padding-box;
    background-color: black;
}
#controls {
    font-family: "Consolas Bold";
    color: white;
    background-color: #444;
    position: absolute;
    right: 0;
    top: 0;
    display: none;
}

#controls-2 {
    display: inline-block;
    font-family: "Consolas Bold";
    color: white;
    background-color: #444; 
}

#colors {
    border: 2px solid #555;
    position: absolute;
    right: 285px;
    top: 3px;
}

#controls ul,
#controls-2 ul {
    font-family: inherit;
    list-style: none;
    padding: 0;
    width: 350px;
}

#controls input, 
#controls-2 input,
#controls select, 
#controls-2 select {
    display: inline-block;
    font-family: "Tw Cen MT Bold";
    font-size: 15px;
    width: 162px;
    margin-left: 12px;
}

#controls input[type=range],
#controls-2 input[type=range] {
    width: 200px;
}

#mode-controls {
    letter-spacing: 1px;
}

#controls input[type=number] {
    width: 60px;
}

#controls #pixelJump input[type=number],
#controls-2 #pixelJump input[type=number] {
    width: 50px;
}

#controls select,
#controls-2 select {
    width: 100px;
}

#hide {
    display: none;
}

#myCanvas2 {
    display:none;
}

#svg3 circle {
    stroke: powderblue;
    stroke-width:0;
}

.fill-0 {
    fill:hsl(0,85%,50%);
}

.fill-2 {
    fill:hsl(45,85%,50%);
}

.fill-4 {
    fill:hsl(90,85%,50%);
}

.fill-6 {
    fill:hsl(135,85%,50%);
}

.fill-1 {
    fill:hsl(180,85%,50%);
}

.fill-3 {
    fill:hsl(225,85%,50%);
}

.fill-5 {
    fill:hsl(270,85%,50%);
}

.fill-7 {
    fill:hsl(315,85%,50%);
}

#svg3 circle {
    fill: inherit;
}

svg polyline,
#svg2 polyline,
#svg3 polyline  {
    fill:transparent;
    stroke-width: 3;
}
#log-parent {
    display:none;
}
#controls-2 select#matrixId ,
#controls-2 #matrixId option {
    width: 250px;
}
#svg-parent {
    display: none;
}
a#citation:link,
a#citation:visited {
    color: inherit;
    padding: 5px;
}
</style>
</head>
<body>
<div id="svg-parent">
<svg id="svg" x="50" y="50" height="100" width="100" viewBox="50 50 100 100">
<defs id="svg-defs">

</defs>

</svg>
</div>

<style>
</style>
<div id="composite">
<canvas id="myCanvas" height="600" width="600">Your browser doesn't support canvas</canvas>
<div id="mrcm-choice">
<div class="mrcm-button">
</div>
</form>

</div>
</div>

<div id="controls-2">
<form id="matrixForm" onChange="runConfig()" onSubmit="return false;">
<input type="hidden" id="matrix-value" />
<input type="hidden" id="collectStatsIn" name="collectStatsIn" value="false"/>
<input type="hidden" id="hideTransformsIn" name="hideTransformsIn" value="true" />

<fieldset>
<legend>The Chaos Game*</legend>
<ul>
<li>
 <label for="matrixId">MRCM:</label>
 <select id="matrixId" name="matrixId">

 </select>
</li>
<li>
<label for="numPointsIn">Points:</label>
<input id="numPointsIn" name="numPointsIn" 
    type="number" min="1000" max="10000000" step="1000" value="50000" />
</li>
<li class="citation"><label for="citation">Citation:</label>
    <a id="citation" href="https://www.semanticscholar.org/paper/The-Chaos-Game%3A-How-Randomness-Creates-Shapes-Peitgen-J%C3%BCrgens/7f0bb13a27bd018c9149fa8789b72007d81346d7">Chaos and Fractals</a>
    <a id="citation" href="http://www.issp.ac.ru/ebooks/books/open/Chaos_and_Fractals.pdf">PDF</a>
</li>
</ul>
</fieldset>
<fieldset id="adjust">
<legend onClick="togglePanel('panel-matrix-options');" id="legend1"
    style="cursor: pointer" 
    title="Click to Minimize/Expand">Matrix Adjustments</legend>
<ul id="panel-matrix-options">
 <li>
 <label for="matrixIndex">Matrix:</label>
 <select id="matrixIndex" 
    name="matrixIndex" 
    onChange="loadMatrixTransform()">
  <option value="0" selected="selected">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
 </select>
 </li>
 <li>
  <label for="r">ScaleX:</label>
  <input id="r" name="r" type="range" min="-1.000" max="1.000" step=".01"
         onChange="updateMatrixTransform('r', '#matrix-one');" >
 </li>
 <li>
  <label for="s">ScaleY:</label>
  <input id="s" name="s" type="range" min="-1.000" max="1.000" step=".01"
         onChange="updateMatrixTransform('s', '#matrix-one');" >
 </li>
 <li>
  <label for="t">SkewY:</label>
  <input id="t" name="t" type="range" min="-6.3" max="6.3" step=".01"
          onChange="updateMatrixTransform('t', '#matrix-one');">
 </li>
 <li>
  <label for="u">SkewX:</label>
  <input id="u" name="u" type="range" min="-6.3" max="6.3" step=".01"
          onChange="updateMatrixTransform('u', '#matrix-one');">
 </li>
 <li>
  <label for="e">E:</label>
  <input id="e" name="e" type="range" min="-600" max="600" step="1"
          onChange="updateMatrixTransform('e', '#matrix-one');">
 </li>
 <li>
  <label for="f">F:</label>
  <input id="f" name="f" type="range" min="-600" max="600" step="1"
        onChange="updateMatrixTransform('f', '#matrix-one');">
 </li>
</ul>
</fieldset>
</form>
</div>
<script>
var Points = new Array();
var w = 600;
var h = 600;
var numPoints = 1000000;
var myImage;
var mrcmIdSelectArray=[];
var panelHidden = false;
var initialConf = {
    matrixId:{
        id:"matrixId",
        value:{
            type:"select",
            value:"16",
            options:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14"]
        },
    },
    matrixIndex:{
        id:"matrixIndex",
        value:{
            type:"select",
            value:"0",
            options:["0","1","2","3","4","5","6","7","8","9"],
        },
    },
    r:{
        id:"r",
        value:{
            type:"range",
            min:-1.000,
            max:1.000,
            value:0.1,
            label:"ScaleX",
        },
    },
    s:{
        id:"s",
        value:{
            type:"range",
            min:-1.000,
            max:1.000,
            value:0.1,
            label:"ScaleY",
        },
    },
    t:{
        id:"t",
        value:{
            type:"range",
            min:-2*Math.PI,
            max:2*Math.PI,
            value:0.0,
            label:"SkewY",
        },
    },
    u:{
        id:"u",
        value:{
            type:"range",
            min:-2*Math.PI,
            max:2*Math.PI,
            value:0.0,
            label:"SkewX",
        },
    },
    e:{
        id:"e",
        value:{
            type:"range",
            min:-600,
            max:600,
            value:300,
            label:"TransX",
        },
    },
    f:{
        id:"f",
        value:{
            type:"range",
            min:-600,
            max:600,
            value:300,
            label:"TransY",
        },
    },
    collectStats:{
        id:"collectStatsIn",
        value:{
            type:"hidden",
            value:"false",
            label:"Stats",
        },
    },
    numPoints:{
        id:"numPointsIn",
        value:{
            type:"number",
            value:1000000,
            label:"Points",
        },
    },
    hideTransforms:{
        id:"hideTransformsIn",
        value:{
            type:"hidden",
            value:"true",
            label:"Hide Transforms",
        },
    },
}

var runConfig = function (conf) {
    conf=conf?conf:processForm();
    let matrixId = parseInt(conf.matrixId.value.value),
        matrixIndex = parseInt(conf.matrixIndex.value.value),
        svgConf = {
            svgId:"svg",
            templateId:"svg-template",
            parentId:"svg-parent",
            height:h,
            width:w,
            x:0,
            y:0,
        };
    
    if (matrixIndex >= CM[matrixId].M.length) {
        matrixIndex = 0;
        conf.matrixIndex.value.value = 0;
    }

    changeImage2(conf,matrixId,matrixIndex);

    updateForm(conf,CM[matrixId].M[matrixIndex]);
}

function updateSelect(selectId,options,appendOptions) {
    let sel = $(`#${selectId}`),
        len = options.length;

    if (!appendOptions) {
        sel.html("");
    }
    for (let i=0,opt;i<len;i++) {
        opt = options[i];
        sel.append(`<option value="${opt.value}">${(opt.text?opt.text:opt.value)}</option>\n`);
    }
}

function togglePanel(ids) {
    var id;
    for (i in arguments) {
        id = arguments[i];
        if (panelHidden) {
            $(`#${id}`).show();
        } else {
            $(`#${id}`).hide();
        }
    }
    panelHidden = !panelHidden;
    
}
window.addEventListener('DOMContentLoaded', () => {
    Log.Notice('Document Ready');
    Log.Remove();
    mrcmIdSelectArray = [];
    
    for (let i=0;i<CM.length;i++) {
        let mrcm = CM[i];
        mrcmIdSelectArray.push(
            {
                value:i,
                text:mrcm.desc,
                subMatrix:mrcm.M.length,
            }
        )
    }
    updateSelect("matrixId",mrcmIdSelectArray,true)
    togglePanel('panel-matrix-options');
    captureR = [];
    runConfig(initialConf)
});

var addressStats = function (inArray,slice) {
    let stats = new Map(),
        len   = inArray.length,
        i     = 0;

    for (let key;i<len-slice;i++) {
        key = inArray.slice(i,slice+i).join("");
        if (!stats.get(key)) {
            stats.set(key,1);
        } else {
            stats.set(key,(stats.get(key)+1));
        }
    }
    return stats;
}

var addressStatsFromString = function (inArray,slice) {
    let stats = new Map(),
        len   = inArray.length,
        i     = 0;

    for (let key;i<len-slice;i++) {
        key = inArray.slice(i,slice+i);
        if (!stats.get(key)) { // change to stats.has(key)
            stats.set(key,1);
        } else {
            stats.set(key,(stats.get(key)+1));
        }
    }
    return stats;
}

var addressStatsIntKeys = function (inArray,slice) {
    let stats = new Map(),
        len   = inArray.length,
        i     = 0;

    for (let key;i<len-slice;i++) {
        key = parseInt(inArray.slice(i,slice+i).join(""));
        if (!stats.get(key)) {
            stats.set(key,1);
        } else {
            stats.set(key,(stats.get(key)+1));
        }
    }
    return stats;
}

function getPerPixelHits(subP=false) {
    let hitMap = new Map(),
        subMap = new Map(),
        len = crObj.p.length,
        point = null,
        key,
        subDim = crObj.p[0].s,
        proto;

    for (let i=0;i<len;i++) {
        point = crObj.p[i]
        key = point.key;
        if (hitMap.has(key)) {
            hitMap.set(key,(hitMap.get(key)+1));
        } else {
            hitMap.set(key,1);
        }
        if (subP) {
            let idx = point.sy*subDim+point.sx;
            if (subMap.has(key)) {
                proto = subMap.get(key);
                proto[idx]++;
                subMap.set(key,proto);
            } else {
                proto = new Array(subDim*subDim).fill(0);
                proto[idx]=1;
                subMap.set(key,proto);
            }
        }
    }
    return {hitMap:hitMap,subMap:subMap};
}
</script>

<script src="https://ajax.googleapis.com/ajax/libs/d3js/3.5.17/d3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://www.highfivediet.com/js/log-2.js" charset="utf-8"></script>
<script src="https://www.highfivediet.com/js/process-form.js" charset="utf-8"></script>
<script src="https://www.highfivediet.com/fractal/mrcm2/js/matrix2.js" charset="utf-8"></script>
<script src="https://www.highfivediet.com/fractal/mrcm2/js/mrcm-affine-demo.js" charset="utf-8"></script>
<script src="https://www.highfivediet.com/fractal/mrcm2/js/matrix-math.js" charset="utf-8"></script>
<script src="https://www.highfivediet.com/fractal/mrcm2/js/mrcm-lib.js" charset="utf-8"></script>


</body>
</html>
