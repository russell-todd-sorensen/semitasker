<html lang="en-US">
<head>
<title>Google 25 Horses: Simplified 2D Solution</title>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" >
<meta name="theme-color" content="#587c00" >
<meta name="description" content="Google 25 Horses: Chain/Graph Solution" >

<link rel="stylesheet" href="/css/meyerweb-reset/reset.css" media="all">

<script src="https://ajax.googleapis.com/ajax/libs/d3js/4.13.0/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="js/google-25-horses-graph.js" ></script>
<script src="js/events.js"></script>

<!-- reuseable template for svg doc-->
<script id="svg-template" type="image/svg+xml">
<form id="animate-horses" onsubmit="return false;">

<fieldset>
<legend>Horse Race Options</legend>
<ul>
<li>
    <label for="numHorsesIn"># Horses</label>
    <input name="numHorsesIn" id="numHorsesIn" type="number" min="1" step="1" max="500" value="25" />
</li>
<li>
    <label for="maxHeatIn">Max Heat</label>
    <input name="maxHeatIn" id="maxHeatIn" type="number" min="2" step="1" max="500" value="5" />
</li>
<li>
    <label for="numPlacesIn">Places</label>
    <input name="numPlacesIn" id="numPlacesIn" type="number" min="1" max="500" step="1" value="3" />
</li>
</ul>
</fieldset>

<fieldset>
<legend>Animate</legend>
<ul>
<li><button id="run-animation">Play Demo</button><li>
<li><button id="reset-maze">Reset</button></li>
<li><button id="solve-maze">Solve</button></li>
</ul>
</fieldset>

</form>
<svg
    id="svgtmp"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    x="0"
    y="0"
    width="1000"
    height="1000"
    viewBox="0 0 1000 1000"
    >
<style>

</style>
<defs>
<rect id="horse-base" height="50" width="50" />
</defs>
</svg>
</script>
<style>
html,
head {
    font-size: 16px;
    font-family: 'Fira Code', 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
}

body {
    font-size: 1em;
    font-family: inherit;
}

svg {
    font-family: inherit;
    display: block;
    margin: 15px;
}

form {
    display: inline;
}

button {
    margin-left: 10px;
}

ul {
    display: inline-block;
}

li {
    display: inline-block;
}

fieldset {
    display: inline-block;
    border: 1px solid black;
    padding: 3px;
    margin: 5px;
    width: 500px;
}

legend {
    border: 1px solid black;
    padding: 3px;
}
label,
input {
    font-family: inherit;
    display: inline-block;
}
input {
    text-align: right;
}
label {
    width: 90px;
}
label:after {
    content: ":"
}
input {
    width: 50px;
}

text.horse-time,
text.horse-name {
    fill: black;
    font-family: 'Fira Code';
    /*font-size: 12px; */
    text-anchor: middle;
}

rect.horse {
    stroke-width: 2px;
    stroke: black;
    fill:white;
}
g.heat {

}
.horse.place-1 {
    fill: gold;
}
.horse.place-2 {
    fill: silver;
}
.horse.place-3 {
    fill: lightpink;
}
.horse.place-4 {
    fill: lightblue;
}
.horse.place-5 {
    fill: yellowgreen;
}
</style>

</head>
<body>

<div id="examples"></div>
<div id="horseRaces"></div>
<script>

class Horse2 {
    static #idSequence = 0;
    id;
    #time = 0.0;
    stats = [];
    followers = [];
    currentPlace = 0;

    constructor() {
        this.id = this.getId();
        this.setTime();
    }

    getId() {
        if (!this.id) {
            ++Horse.#idSequence;
            this.id = `horse-${Horse.#idSequence}`;
        }
        return this.id;
    }
    setTime() {
        if (this.#time === 0.0) {
            this.#time = parseInt(Math.random()*10000)/100;
        }
    }
    getTime () {
        return this.#time;
    }
    static timeDiff(a,b) {
        let aTime = a.#time,
            bTime = b.#time,
            diff  = aTime - bTime;

        if (Math.abs(diff) < Number.EPSILON) {
            diff = 0;
        }
        console.log(`aTime='${aTime}', bTime='${bTime}'`);
        return diff;
    }
    static cmpId(a,b) {
        let aid = parseInt(a.id.split("-")[1]),
            bid = parseInt(b.id.split("-")[1]);

        return aid<bid?-1:1;
    }
    static cmp(a,b) {
        let val = Horse.timeDiff(a,b);
        // note: in case of 0, return -1 if a.id < b.id
        return (val>0?1:val<0?-1:Horse.cmpId(a,b));
    }
}
var numHorses = 25,
    maxHeat   = 5,
    numPlaces = 3,
    activeLayer = 0,
    Layers = [];


var init = function(numHorses) {
    let layer = [];
    for (let i=0;i<numHorses;i++) {
        layer.push(new Horse())
    }
    return layer;
}

Layers[activeLayer] = init(numHorses);

var race = function(layerArray,layer,max) {
    let heat    = [],
        startLayer = 0+layer,
        inLayer = layerArray[layer];
    while (inLayer.length > 0 && heat.length < max) {
        heat.push(inLayer.shift())
    }
    heat.sort(Horse.cmp);
    while (heat.length > 0) {
        if (layerArray[layer]) {
            layerArray[layer].push(heat.shift());
            layer++;
        } else {
            layerArray[layer] = [heat.shift()];
            layer++;
        }
    }
    if (layerArray[startLayer].length == 1) {
        startLayer++;
    }
    return startLayer;
}

var race2 = function(layerArray,layer,max,places) {
    let heat    = [],
        startLayer = 0+layer,
        inLayer = layerArray[layer];
    while (inLayer.length > 0 && heat.length < max) {
        heat.push(inLayer.shift())
    }
    heat.sort(Horse.cmp);
    while (heat.length > 0 && layer < places) {
        if (layerArray[layer]) {
            layerArray[layer].push(heat.shift());
            layer++;
        } else {
            layerArray[layer] = [heat.shift()];
            layer++;
        }
    }
    if (layerArray[startLayer].length == 1) {
        startLayer++;
    }
    return startLayer;
}

//while (activeLayer < numPlaces) {
//        activeLayer = race(Layers,activeLayer,maxHeat)
//}

var runMeet = function (layerArray,active,max,places) {
    let activeLayer = active,
        numHeats = 0;
    while (activeLayer < places) {
        activeLayer = race(layerArray,activeLayer,max);
        numHeats++;
    }
    return numHeats;
}

var runMeet2 = function (layerArray,active,max,places) {
    let activeLayer = active,
        numHeats = 0;
    while (activeLayer < places) {
        activeLayer = race2(layerArray,activeLayer,max,places);
        numHeats++;
    }
    return numHeats;
}

//runMeet(Layer,activeLayer,maxHeat,numPlaces);


</script>
<script>
window.addEventListener('DOMContentLoaded', () => {
   // svgDraw({},"svgOne","svg-template","exampleOne");
});
</script>

</body>
</html>