<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8" >

<title>Longest Valid Parentheses</title>
<style>
</style>
<script src=""></script>

<script>
/* from: https://leetcode.com/problems/longest-valid-parentheses/
Given a string containing just the characters '(' and ')', find
 the length of the longest valid (well-formed) parentheses substring.

Example 1:

Input: "(()"
Output: 2
Explanation: The longest valid parentheses substring is "()"
Example 2:

Input: ")()())"
Output: 4
Explanation: The longest valid parentheses substring is "()()"

*/

/**
 * @param {string} s
 * @return {number}
 */

class Candidate {
    startIndex;
    endIndex;
    balance;
    maxValid = 0;
    value = "";
    possiblyValid = true;
    validValue = "";
    constructor(start) {
        this.startIndex = start;
        this.endIndex = -1;
        this.balance = 1;
        this.value = "(";
        return this;
    }
    openP (current) {
        this.balance++;
        this.endIndex = current;
        this.value+= "(";
        return this.balance;
    }
    closeP (current) {
        this.value+= ")";
        this.balance--;
        switch (this.balance) {
        case -1: 
            this.possiblyValid = false;
            break;
        case 0: 
            this.maxValid = current - this.startIndex + 1;
            this.endIndex = current;
            this.validValue = this.value;
            break;
        default:
            break;
        }
        return this.balance;
    }
    toString () {
        return this.validValue
    }
}

var candidateList = [];

var longestValidParentheses = function(s) {

    candidateList = [];
    let longest = 1, // this is an impossible length
        v,
        cand,
        retire,
        bal,
        max,
        all = [];

    for (let i=0;i<s.length;i++) {
        v = s[i]
        switch (v) {
        case "(":
            for (let j=0;j<candidateList.length;j++) {
                candidateList[j].openP(i);
            }
            candidateList.unshift(new Candidate(i))
            break;
        case ")": 
            retire = candidateList.shift(); 
            if (!retire) {
                break;
            }
            retire.closeP(i);
            max = retire.maxValid;
            if (max > longest) {
                longest = max;
                all = [retire]
            } else if (max == longest) {
                all.push(retire);
            }
            for (let j=0;j<candidateList.length;j++) {
                candidateList[j].closeP(i);
                if (candidateList[j].balance == -1) {
                    candidateList.shift();
                    j--
                }
            }
            if (retire.balance == 0) {
                candidateList.unshift(retire);
            }
            break;
        default: 
            return 0
        }
    }
    for (let j=0;j<candidateList.length;j++) {
        cand = candidateList[j];
        max = cand.maxValid;
        if (max > longest) {
            longest = max;
            all = [cand]
        } else if (max == longest) {
            all.push(cand);
        }
    }
    //return (longest < 2 ? 0 : longest);
    //return [longest, ...all.map( (obj) => { return obj.validValue;})]
    return [longest, all]
};

var result = longestValidParentheses("()");

console.log ("result = " + result)


</script>
</head>
<body>
<pre>

</pre>
</body>
</html>


