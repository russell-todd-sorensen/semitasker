<html>
<head>
<script>
class Candidate {
    startIndex;
    endIndex;
    balance;
    maxValid = 0;
    constructor(start) {
        this.startIndex = start;
        this.balance = 1;
        return this;
    }
    openP (current) {
        this.balance++;
        return this.balance;
    }
    closeP (current) {
        this.balance--;
        if (this.balance == 0) {
            this.maxValid = current - this.startIndex + 1;
            this.endIndex = current;
        }
        return this.balance;
    }
}

var candidateList = [];

var longestValidParentheses = function(s) {

    candidateList = [];
    let longest = 1, // this is an impossible length
        v,
        cand,
        max;

    for (let i=0,vi=0;i<s.length;i++,vi++) {
        v = s[i]
        switch (v) {
        case "(":
            for (let j=0;j<candidateList.length;j++) {
                candidateList[j].openP(vi);
            }
            candidateList.unshift(new Candidate(vi))
            break;
        case ")":
            if (candidateList.length == 0) {
                break;
            }
            for (let j=0;j<candidateList.length;j++) {
                cand = candidateList[j]
                cand.closeP(vi);
                if (cand.balance == 0) {
                    max = cand.maxValid;
                    if (max > longest) {
                        longest = max
                    }
                } else
                if (cand.balance == -1) {
                    candidateList.shift();
                    j--
                }
            }
            break;
        default: 
            vi--;
            break;
        }
    }
    return (longest < 2 ? 0 : longest);
};
</script>
</head>
<body>
<b>Hi</b>
</body>
</html>


