<!DOCTYPE HTML>
<html lang="en_US">
<head>
<meta charset="utf-8">
<title>Fractal Image Creation in JavaScript</title>
<link rel="stylesheet" href="main.css" type="text/css">
<link rel="stylesheet" type="text/css" href="http://ic00408/css/log.css" media="all">
<link rel="stylesheet" type="text/css" href="http://ic00408/js/jQuery.UI.Combined.1.8.20.1/Content/Content/themes/base/jquery.ui.all.css">


<style>
 
body {

}
#myCanvas {
    border: 1px solid black;
}
 
#container {
    border: 1px solid black;
}

#circle {
    fill: green;

}

</style>

<script src="http://ic00408/js/jquery-1.7.1.js"></script>
<script src="http://ic00408/js/jQuery.UI.Combined.1.8.20.1/Content/Scripts/jquery-ui-1.8.20.js"></script>
<script src="http://ic00408/js/d3.v3.js"></script>
<script src="http://ic00408/js/log-2.js"></script>
<script src="http://ic00408/js/data.js"></script>
<script src="http://ic00408/js/form-save-restore.js"></script>
<script src="http://ic00408/js/binary-hex-conversions.js"></script>
<script src="http://ic00408/js/example-library.js"></script>
<script src="http://ic00408/js/svg-transform.js"></script>
<script language="javascript">

var height = 100;
var width = 100;
var points = new Array();

function calculatePoints () {

	var cX = -0.1;
	var cY =  0.1;
	var rect = {
		start: {
			x: -1.5,
			y: -0.5
		},
		end: {
			x: -.50,
			y: 0.00
		}
	}
	
	var counter;
	var finite;
	for (var x = rect.start.x; x < rect.end.x; x+=1/width) {
		for (var y = rect.start.y; y < rect.end.y ; y+=1/height) {
			counter = 0;
			finite = true;
			newX = x;
			newY = y;
			tmpX = x;
			tmpY = y;
			cY = y;
			cX = x;
			while (counter < 256 && finite) {
				newY = cY +  2 * tmpX * tmpY;
				newX = cX + (-1 * tmpY * tmpY) + tmpX * tmpX;
        tmpX = newX;
				tmpY = newY;
				//if (Math.abs(newX*newY) > 5) {
				if (newX*newX+newY*newY > 256) {
					finite = false;
				}
				counter++;
			}
      if (counter == 256) {
				continue;
			}
			points[points.length] = {cx:x,cy:y,counter:counter,finite:finite}
			//Log.Notice('points.counter=' + points[points.length-1].counter +'points.cx=' + points[points.length-1].cx + 'points.cy=' + points[points.length-1].cy );
		}	
	}
		
}

function animatePoints(id) {
	var g = d3.select('#' + id);
	
	g.selectAll('circle')
	 .data(points)
	 .enter()
	 .append('circle')
	 .attr('r',0.5/height)
	 .attr('cx', function(d,i) {return d.cx})
	 .attr('cy', function(d,i) {return d.cy})
	 .attr('fill', function(d,i) {
		 return 'rgb(' + Math.abs((255-40*d.counter)%255) 
		 		+ ',' + Math.abs((255-40*d.counter)%255)
		 		+ ',' + Math.abs((255-40*d.counter)%255)
				+ ')';
	 })
}

function animatePoints(id) {
	var g = d3.select('#' + id);
	
	g.selectAll('circle')
	 .data(points)
	 .enter()
	 .append('circle')
	 .attr('r',0.5/height)
	 .attr('cx', function(d,i) {return Math.round(d.cx*1000000)/1000000})
	 .attr('cy', function(d,i) {return Math.round(d.cy*1000000)/1000000})
	 .attr('opacity', function(d,i) {
		  return 1-Math.round((Math.abs((255-20*d.counter)%255)/255)*1000)/1000;
	 })
}
var i = 0;
function animatePoints2(id) {
	var g = d3.select('#' + id);
	var point;
	
	for (var r = 0; i<points.length || r<10000; i++,r++) {
		point = points[i];
		g.append('circle')
	 		.attr('r',0.5/height)
	 		.attr('cx',point.cx)
			.attr('opacity',(Math.round((1-point.counter/255)*1000))/1000);
	 		//	+ ',' + Math.abs((255-40*point.counter)%255)
		 	//	+ ',' + Math.abs((255-40*point.counter)%255)
			//	+ ')');
	}
}


function animateAgain(id) {
		var g = d3.select('#' + id);
	
	g.selectAll('circle')
	 .data(points)
	 .transition()
	 .duration(4000)
	 .delay(function (d,i) {
	    return d.counter * 5;
	 })
	 .ease('bounce')
	 .attr('r', function (d,i) {
		 d.r = d3.select(this).attr('r');
		 return .5*d.r;
	 })
	 .each('end', function (d,i) {
		 var c = d3.select(this);
		 d.r = c.attr('r');
	   c
		 	.transition()
			.ease('bounce')
			.delay(d.counter * 40)
			.duration(4000)
		 	.attr('r', d.r*2);
	 });
	
	
}
// This runs at after the document is 'ready'
$(document).ready(function() {
	
	Log.Notice('Document Ready');
  calculatePoints();
	Log.Notice('points calculated length ='  + points.length);
	animatePoints('mPoints');

});
</script>
 


</head>
<body>
<div id="container">
<svg id="svg" x="-1000" y="-1000" height="2000" width="2000" viewBox="-2 -2 .4 .4">
<defs>

<circle id="c1" r="1" stroke="none" stroke-width="0" >

</circle>
</defs>

<g transform="translate(-0.45,-1.00) scale(.25) translate(-4.65,-3.45)" id="mPoints" >


</g>

</svg>
</div>
</body>
</html>
