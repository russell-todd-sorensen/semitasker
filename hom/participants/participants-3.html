<!DOCTYPE HTML>
<html lang="en_US">
<head>
<meta charset="utf-8">
<meta base="http://hom1:8080/" />
<title>House of Mercy: Participants</title>

<link rel="stylesheet" type="text/css" media="all" href="http://github.semitasker.com/css/log.css">
<link rel="stylesheet" type="text/css" media="all" href="http://github.semitasker.com/js/jQuery.UI.Combined.1.8.20.1/Content/Content/themes/base/jquery.ui.all.css">
<link rel="stylesheet" type="text/css" media="all" href="http://github.semitasker.com/css/logo-maker-1.css">
<link rel="stylesheet" type="text/css" media="all" href="http://github.semitasker.com/css/green-form.css" >

<style type="text/css">

body {
    font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
}

/* override #panel  styles */
#panel fieldset {
    width: 400px;
}

#panel input,
#panel input[type="range"] {
    display: inline-block;
    width: 196px;
    height: 1.7em;
}

#panel li.expand span {
    display: inline-block;
    width: 4em;
    text-align: right;
}

#panel select {
    width: 200px;
}

.cust {
    cursor: pointer;
    width: 450px;
}
.cust:hover {
    background-color: lightgreen;
}
#container {
    vertical-align: top;
}

#selection, 
#profile {
    display: inline-block;
    width: 450px;
    vertical-align: top;
}

#profile {
    background-color: #cff;
    border: solid #060 1px;
}
#profile label {
    font-weight: bold;
    vertical-align: top;
}
#profile pre {
    display: inline-block;
}

</style>

<script type="text/javascript" src="https://d3js.org/d3.v4.js"></script>
<script type="text/javascript" src="http://github.semitasker.com/js/jquery-1.7.1.js"></script>
<script type="text/javascript" src="http://github.semitasker.com/js/jQuery.UI.Combined.1.8.20.1/Content/Scripts/jquery-ui-1.8.20.js"></script>
<script type="text/javascript" src="http://github.semitasker.com/js/log-2.js"></script>
<script type="text/javascript" src="http://github.semitasker.com/js/data.js"></script>
<script type="text/javascript" src="http://github.semitasker.com/js/form-save-restore.js"></script>
<script type="text/javascript" src="http://github.semitasker.com/js/binary-hex-conversions.js"></script>
<script type="text/javascript" src="http://github.semitasker.com/js/example-library.js"></script>
<script type="text/javascript" src="http://github.semitasker.com/js/svg-transform.js"></script>
<script type="text/javascript" src="load-2.js"></script>

<script>


var Customer = {
    configureSearchField: function (selectId) {
        fieldToSearch = $('#' + selectId + ' option:selected').val();
        Data.saveSelect(selectId,'Customer.restoreSearchField');
    },
    restoreSearchField: function (selectId) {
        Data.restoreSelect(selectId);
        fieldToSearch = $('#' + selectId + ' option:selected').val();
    },
    configureSearchList: function (selectId) {
        searchList = $('#' + selectId + ' option:selected').val();
        tmpSearchList = searchLists[searchList].list;
        Data.saveSelect(selectId,'Customer.restoreSearchList');
    },
    restoreSearchList: function (selectId) {
        Data.restoreSelect(selectId);
        searchList = $('#' + selectId + ' option:selected').val();
        tmpSearchList = searchLists[searchList].list;
    },
    restore: function (inputId) {
        Data.restoreInput(inputId);
        var searchString = $('#' + inputId).val();
        searchLength = searchString.length;
    },
    search: function (inputId, outputSelector) {
        evt = event;
        var searchString = $('#' + inputId).val();
        var searchRegExp = new RegExp(searchString,"i");
 
        if (tmpSearchList.length == 0) {
            tmpSearchList = searchLists[searchList].list;   
        }
        if (evt.key == "Backspace") {
            tmpSearchList = searchLists[searchList].list;
        }
        if (searchString.length <= searchLength) {
            tmpSearchList = searchLists[searchList].list;
        }
        
        searchLength = searchString.length;
        var match = [];
        var tmpTmpSearchList = [];
        for (var i = 0;i<tmpSearchList.length;i++) {
            customer = tmpSearchList[i];
            match = customer[fieldToSearch].match(searchRegExp);
            if (match) {
                tmpTmpSearchList.push(customer);
            }
        }
        if (tmpTmpSearchList.length > 0) {
            tmpSearchList = tmpTmpSearchList;
            $(outputSelector).html('');
            $(outputSelector).append('<pre>');
            for (var i = 0;i<tmpSearchList.length;i++) {
                customer = tmpSearchList[i];
                $(outputSelector).append(',,"' + customer.lastName + ', ' + customer.firstName
                   + '",,' + customer.house + '<br>');
                
            }
            
            $(outputSelector).append('</pre>');
            Data.saveInput(inputId,'Customer.restore');
        } else {
            // restore previous search term
            if (evt.key == "Backspace") return;
            var newSearchString = searchString.substring(0,searchString.length-1)
            $('#' + inputId).val(newSearchString);
            searchLength = newSearchString.length;
        }
    },
    find: function (list, id) { // returns index of participant in list, with given id
        var customer;
        id = parseInt(id);
        for (var i = 0; i<list.length;i++) {
            customer = list[i];
            if (customer.id == id) {
                return i;
            }
        }
        return -1;
    },
    show: function (id) {
        var index = Customer.find(tmpSearchList,id);
        if (index == -1) {
            $('#profile').html('');
        } else {
            var customer = tmpSearchList[index];
            var html = '\n<div id="panel">';
            html += '\n<ul>';
            html += '\n<li><label>Participant</label>';
            html += customer.firstName + ' ' + customer.lastName + '</li>';
            html += '\n<li><label>DOC</label>' + customer.doc + '</li>';
            html += '\n<li><label>CCO</label>' + customer.cco + '</li>';
            html += '\n<li><label>SOTP</label>' 
            html +=  customer.sotp + '</label>';
            html += '\n<li><label>Active</label>';
            html += (customer.sotp ? 'Yes' : 'No') + '</li>';;
            html += '\n<li><label>Birthday</label>' + customer.dob + '</li>';
            html += '\n<li><label>Arrived</label>' + customer.startDate + '</li>';
            html += '\n<li><label>Address</label>' + '<pre>' + customer.address + '</pre></li>';
    
            html += '\n</ul></div>'
            
            $('#profile').html(html);
        }
        return index;
    },
  
};



$(document).ready(function() {

    console.log("Starting to get data");
    loadIntuitInterchangeFormatFile("all-customer-data-2016-09-20-1");
    //Data.restoreSelect('fieldToSearch');
    
});



</script>

</head>
<body>

<form id="panel" onSubmit="javascript:return false">
<fieldset>
<legend>Participant Search</legend>
<ul>
 <li><label for="fieldToSearch">Search Field:</label>
 <select id="fieldToSearch"
  onChange="Customer.configureSearchField('fieldToSearch')">
   <option value="search">All Fields</option>
   <option value="name">Name</option>
   <option value="doc">DOC #</option>
   <option value="cco">CCO</option>
   <option value="house">House</option>
  </select>
  </li>
 <li><label for="searchList">List:</label>
 <select id="searchList" name="searchList"
  onChange="Customer.configureSearchList('searchList')">
   <option value="active" selected="selected">Active</option>
   <option value="all">All</option>
   <option value="leaders">House Leaders</option>
   <option value="terminated">Terminated</option>
   <option value="left">Left Program</option>
  </select>
  </li>
  <li><label for="searchTerms">Search For:</label>
  <input type="text" id="searchTerms" name="searchTerms"
   onKeyUp="Customer.search('searchTerms','#selection');" />
 </ul>
 </fieldset>

</form>
<div id="container">
<div id="selection"></div>
<div id="profile"></div>
</div>
</body>
</html>
