<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8" >

<title>Maze: Mouse-Wheel-Only Game</title>
<style>
</style>
<script>
// avoid need to load logging widget
var Log = {}
Log.Notice = function() {}
Log.Hide = function() {}
Log.Remove = function() {}
Log.Debug = function() {}
</script>
<script src="https://ajax.googleapis.com/ajax/libs/d3js/3.5.17/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="js/style.js"></script>
<script src="js/maze-mouse-wheel.js"></script>
<script>

var SVGDoc,
    textId
    handleScroll = null;

var init = function() {
    scrollRef1 = document.getElementById(scrollValues[0]["wheelId"]);
    scrollRef1.onmousewheel = handleScroll;
    scrollRef2 = document.getElementById(scrollValues[0]["id"]);
    scrollRef2.onmousewheel = handleScroll;

    SVGDoc = document.getElementById(config.svgId);
    textId = config.textId;
    replaceStyleProperty(SVGDoc,textId,"font-family",config.fontFamily);
}

</script>

</head>
<body>
<svg 
    id="svg2"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    externalResourcesRequired="true"
    x="-100"
    y="-100"
    width="1000"
    height="1000"
    viewBox="-100 -100 1000 1000"
    >
<style>
@import url('https://fonts.googleapis.com/css?family=Aclonica|Alfa+Slab+One|Anton|Archivo+Black|Astloch|Audiowide|Bahianita|Baloo|Baumans|Berkshire+Swash|Big+Shoulders+Text|Bilbo+Swash+Caps|Black+And+White+Picture|Black+Ops+One|Bree+Serif|Bungee+Inline|Bungee+Shade|Cabin+Sketch|Caesar+Dressing|Ceviche+One|Chilanka|Cinzel+Decorative|Coiny|Concert+One|Cute+Font|Days+One|Erica+One|Fascinate|Faster+One|Fredericka+the+Great|Fredoka+One|Fugaz+One|Galindo|Geo|Geostar+Fill|Germania+One|Gochi+Hand|Gravitas+One|Gruppo|Gugi|Hanalei|IM+Fell+English|Iceberg|Iceland|Indie+Flower|Josefin+Sans|Keania+One|Kenia|Krub|Leckerli+One|Limelight|Luckiest+Guy|Major+Mono+Display|Megrim|Metamorphous|Milonga|Miltonian+Tattoo|Monofett|Monoton|Montserrat+Alternates|Nanum+Brush+Script|Nixie+One|Nova+Round|Orbitron|Original+Surfer|Pacifico|Patua+One|Permanent+Marker|Petit+Formal+Script|Plaster|Poller+One|Press+Start+2P|Rammetto+One|Rationale|Righteous|Roboto|Rubik|Rubik+Mono+One|Rum+Raisin|Ruslan+Display|Saira+Stencil+One|Shojumaru|Shrikhand|Sigmar+One|Sirin+Stencil|Skranji|Smokum|Snowburst+One|Squada+One|Stalinist+One|Turret+Road|UnifrakturCook:700|UnifrakturMaguntia|VT323|Viga|Wallpoet|Wire+One|ZCOOL+KuaiLe|ZCOOL+QingKe+HuangYou|Zilla+Slab+Highlight&amp;display=swap');
</style>


<defs>
<style>
#t2 {
    font-size: 48px;
    fill:#587c00;
    font-family: 'Days One';
}
#svg-scroller {
    cursor: pointer;
    font-family: 'Days One';
    font-size: 20px;
}

#scroller-1 {
    fill: white;
    stroke-width: 3px;
    stroke: #00587c;
}

#scroller-2 {
    stroke: #7c5800;
    stroke-width: 3px;
    fill: #00587c;
}

#scroll-value {
    font-family: 'Days One';
    fill: #7c5800;
    stroke: none;
    text-anchor: middle;
}

#font-value {
    font-family: 'Days One';
    fill: white;
    stroke: none;
    text-anchor: middle;
}

#scroll-text {
    font-size: 100px;
}

#scroll-font {
    font-size: 21.5px;
}

.V-part-0,
.H-part-0 {
    stroke-width: .5;
    stroke: rgba(0,204,104,.7);
    stroke-linejoin: bevel;
}

.V-part-1,
.H-part-1 {
    stroke-width: .5;
    stroke: rgba(0,0,0,.2);
    stroke-linejoin: bevel;
}
.V-part-2,
.H-part-2 {
    stroke-width: 1;
    stroke: rgba(204,104,0,1);
    stroke-linejoin: bevel;
}

.V-part-3,
.H-part-3 {
    stroke-width:2;
    stroke: rgb(0,0,0);
    stroke-linejoin:bevel;
}

.V-part-4,
.H-part-4 {
    stroke-width:2;
    stroke: rgba(255,0,0,0.5);
}

.V-part-0 line,
.H-part-0 line,
.V-part-1 line,
.H-part-1 line,
.V-part-2 line,
.H-part-2 line,
.V-part-3 line,
.H-part-3 line,
.V-part-4 line,
.H-part-4 line   {
    stroke-width:inherit;
    stroke: inherit;
    stroke-linejoin: inherit;
}

#cells use.C-base {
    fill: #8080aa; 
    fill: white;
}

#cells use.C-start {
    fill: rgba(80,255,80,.7);
}

#cells use.C-base rect,
#cells use.C-start rect {
    fill: inherit;
}
</style>
 <text 
    id="t2"
    transform="skewX(0)"
    style="font-family:'Days One'"
    ><tspan>ABCDEFGHIJKLMNOPQRSTUVWXYZ</tspan>
 <tspan dy="100" x="0">abcdefghijklmnopqrstuvwxyz</tspan></text>
 <text id="scroll-value" >25</text>
 <rect id="scroller" height="80" width="300" />
 <text id="font-value">Days One</text>
 <text id="font-index">25</text>
 <rect id="font-scroller" height="40" width="300" />

<g id="controls" transform="scale(1)" >
    <g id="scroll-container"  transform="translate(50,10) scale(1)">
        <use id="scroller-1" class="scroll" xlink:href="#scroller" />
        <use id="scroll-text" xlink:href="#scroll-value" x="150" y="75" />
    </g>

    <g id="scroll-container"  transform="translate(50,90) scale(1)">
        <use id="scroller-2" xlink:href="#font-scroller" />
        <use id="scroll-font" xlink:href="#font-value" x="150" y="26" />
    </g>
</g>
<g id="text-group" transform="translate(10,250)">
    <use id="text-display" xlink:href="#t2" x="10" y="10" />
</g>
<!-- Drawn maze components shound show up here.-->
<rect id="cell-base" height="100" width="100" />
<line id="hwall-base" x1="0" y1="0" x2="100" y2="0" /> 
<line id="vwall-base" x1="0" y1="0" x2="0" y2="100" />
</defs>

</svg>

<script>
var config = {
    textId: 't2',
    pointsId: 'mPoints2',
    svgId: 'svg2',
    formFontSizeId: 'fontSize',
    formFontFamilyId: 'fontFamily',
    textHref: '#t2',                //the hash is part of the href :(
    defaultFontIndex: 4,            // Arial
    fontSize: 48,
    updateFontSize: false,
    fontFamily: 'Arial',
    updateFontFamily: false,
}

class Maze {
    rows    = 11;
    cols    = 11;
    cells   = (this.rows) * (this.cols);
    scale   = 100;
    startId = "C-0-0";
    exitId  = `V-${this.rows}-${this.cols}`;
    EXIT    = 4;
    WALL    = 3;
    OPEN    = 0;
    SHUT    = 1;
    LOCK    = 2;
    N       = 0;
    E       = 1;
    S       = 2;
    W       = 3;
    state   = [];
    celln   = [];
    parts   = [];
    hparts  = [];
    vparts  = [];
    flatCells  = []; 

    constructor(config) {
        for (const [key, value] of Object.entries(config)) {
            this[key] = value;
        }
        this.setCells();
        this.setParts();
    }
    setCells(cols,rows) {
        if (cols) {
            this.cols = cols;
        }
        if (rows) {
            this.rows = rows;
        }
        this.cells = (this.rows) * (this.cols);
        for (let r=0;r<this.rows;r++) {
            this.celln[r] = [];
            for (let c=0,tmpCell;c<this.cols;c++) {
                tmpCell = {
                     c:c,
                     r:r,
                    id:`C-${c}-${r}`,
                    nw:`H-${r}-${c}`,
                    ew:`V-${c+1}-${r}`,
                    sw:`H-${r+1}-${c}`,
                    ww:`V-${c}-${r}`,
                }
                this.celln[r][c] = tmpCell;
                this.flatCells.push(tmpCell);
            }
        }
    }
    setParts () {
        let n    = this.N,
            e    = this.E,
            s    = this.S,
            w    = this.W,
            wall = this.WALL,
            open = this.OPEN,
            hmax = this.rows+1,
            vmax = this.cols+1;

        this.parts["H"] = [];
        this.parts["V"] = [];

        for (let h=0;h<hmax;h++) {
            this.parts["H"][h] = [];
            for (let c=0;c<this.cols;c++) {
                this.parts["H"][h][c] = 0; 
            }
        }
        for (let v=0;v<vmax;v++) {
            this.parts["V"][v] = [];
            for (let r=0;r<this.rows;r++) {
                this.parts["V"][v][r] = 0; 
            }
        }
    }
    wallPerimeter(logit) {
        let n    = this.N,
            e    = this.E,
            s    = this.S,
            w    = this.W,
            wall = this.WALL,
            open = this.OPEN,
            hmax = this.rows+1,
            vmax = this.cols+1,
            hwal = [0,this.rows],
            vwal = [0,this.cols];

        for (let i=0,r;i<hwal.length;i++) {
            r = hwal[i];
            for (let c=0;c<this.cols;c++) {
                this.parts["H"][r][c] = wall;
            }
        }
        for (let j=0,c;j<vwal.length;j++) {
            c = vwal[j];
            for (let r=0;r<this.rows;r++) {
                this.parts["V"][c][r] = wall;
            }
        }
    }
    markExit(exitId) {
        if (exitId) {
            this.exitId = exitId;
        }
        let [t,i,j] = (this.exitId).split("-");
        i = parseInt(i);
        j = parseInt(j);

        switch (t) {
        case "V":
        case "H": 
            this.parts[t][i][j] = this.EXIT;
            break;
        default:
            this.parts["H"][this.rows][this.cols] = this.EXIT;
            this.exitId = `H-${this.rows}-${this.cols}`;
            break;
        }
        return this.exitId;
    }
    wallStart(startId,state) {
        if (startId) {
            this.startId = startId;
        }

        let [t,x,y] = (this.startId).split("-");
        x = parseInt(x);
        y = parseInt(y);

        if (!state) {
            state = [null,this.wall,null,null];
        }
        for (let k=0;k<state.length;k++) {
            let st = state[k];

            if (st == null) continue;

            switch (k) {
            case this.N: 
                this.parts["H"][y][x] = st;
                break;
            case this.E: 
                this.parts["V"][x+1][y] = st;
                break;
            case this.S: 
                this.parts["H"][y+1][x] = st;
                break;
            case this.W: 
                this.parts["V"][x][y] = st;
                break;
            }
        }
    }
    configPart(id,action) {
        let [t,i,j] = (id).split("-");
        i = parseInt(i);
        j = parseInt(j);

        switch (t) {
        case "V":
        case "H": 
            this.parts[t][i][j] = action;
            break;
        default:
            error(`unknown type=${t} id=${id} action=${action}`)
            break;
        }
        return id;
    }
    removeWall(wallId) {
        return this.configPart(wallId,this.OPEN);
    }
    insertWall(wallId) {
        return this.configPart(wallId,this.WALL);
    }
    shutDoor(partId) {
        return this.configPart(partId,this.SHUT);
    }
    lockDoor(partId) {
        return this.configPart(partId,this.LOCK);
    }
    getState(partId) {
        let [t,i,j] = (partId).split("-");
        i = parseInt(i);
        j = parseInt(j);

        return this.parts[t][i][j];
    }
    drawMaze(svgId,mazeObj) {
        let svg = d3.select(`#${svgId}`),
            maze = svg
                .append("g")
                .attr("id","maze1")
                .attr("transform","translate(100,100)"),
            cells = maze 
                .append("g")
                .attr("id","cells")
                .attr("transform","translate(0,0)"),
            hwalls = maze
                .append("g")
                .attr("id","hwalls")
                .attr("transform","translate(0,0)"),
            vwalls = maze
                .append("g")
                .attr("id","vwalls")
                .attr("transform","translate(0,0)");
        
        // flatten cells 2dim array
        let flatCells = mazeObj.flatCells,
            rows = mazeObj.rows,
            cols = mazeObj.cols,
            parts = mazeObj.parts; //partitions (walls/doors)

        cells.html("");
        cells.selectAll("use")
            .data(flatCells)
            .enter()
            .append('use')
            .attr("id",function(d,i) {
                return d.id;
            })
            .attr("href","#cell-base")
            .attr("x",function(d,i) {
                return (d.c*100)
            })
            .attr("y",function(d,i) {
                return (d.r*100)
            })
            .attr("class","C-base")
            .attr("title",function(d,i) {
                return d.id;
            });

        // flatten wall/doors
        let H = parts["H"],
            dim = 100;

        for (let y=0,r;y<H.length;y++) {
            r = H[y];
            for (let x=0,c;x<r.length;x++) {
                mazeObj.hparts.push({
                    x:x*dim,
                    y:y*dim,
                    idx:["H",y,x],
                    id:`H-${y}-${x}`,
                    state:r[x],
                    type:"H",
                });
            }
        }

        let V = parts["V"];

        for (let x=0,c;x<V.length;x++) {
            c = V[x];
            for (let y=0;y<c.length;y++) {
                mazeObj.vparts.push({
                    x:x*dim,
                    y:y*dim,
                    idx:["V",x,y],
                    id:`V-${x}-${y}`,
                    state:c[y],
                    type:"V",
                });
            }
        }

        hwalls.html("");
        hwalls.selectAll("use")
            .data(myMaze.hparts)
            .enter()
            .append("use")
            .attr("id",function(d,i) {
                return d.id;
            })
            .attr("href","#hwall-base")
            .attr("x",function(d,i) {
                return d.x;
            })
            .attr("y",function(d,i) {
                return d.y;
            })
            .attr("class",function(d,i) {
                return `${d.type}-part-${d.state}`
            });

        vwalls.html("");
        vwalls.selectAll("use")
            .data(myMaze.vparts)
            .enter()
            .append("use")
            .attr("id",function(d,i) {
                return d.id;
            })
            .attr("href","#vwall-base")
            .attr("x",function(d,i) {
                return d.x;
            })
            .attr("y",function(d,i) {
                return d.y;
            })
            .attr("class",function(d,i) {
                return `${d.type}-part-${d.state}`
            });
        d3.select(`#${mazeObj.startId}`).attr("class","C-start");
    }
}


var myMaze = new Maze({cols:5,rows:7,startId:"C-2-0",exitId:"H-5-4"});
myMaze.wallPerimeter();
myMaze.wallStart("C-3-0",[null,3,3,null]);
myMaze.markExit("V-5-4");
myMaze.drawMaze("svg2",myMaze);




window.addEventListener('DOMContentLoaded', () => {
    config.fontFamily = "'Days One'";
    config.defaultFontIndex = 25;
    //init();
});

</script>
</body>
</html>