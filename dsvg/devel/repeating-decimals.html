<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8" >

<base href="https://home.semitasker.com/">
<title></title>
<style>
.red {
    color: red;
}
td {
    text-align: right;
    font-family:'Lucida Sans Unicode', monospace;
}
td.al {
    text-align: left;
}
tr.hl {
    background-color: rgb(255,200,200);
}
td.er {
    background-color: rgb(255,100,255);
}
</style>
<script src="/js/base-conversion.js"></script>
<script src="/js/fraction-to-recurring-decimal.js"></script>
<script src="/chemical-pi/js/pi-digits.js"></script>
<script src="/js/math.js"></script>
<script src="/js/x2-test.js"></script>
<script>

var toggleStyle = function (evt) {
    let styleClass = this.className
    if (styleClass == 'hl') {
        this.className = ""
    } else {
        this.className = 'hl'
    }
}

let setClickEvents = function (evt) {
    let rows = document.getElementsByTagName('tr');
    let row;
    for (let i in rows) {
        row = rows[i];
        row.onclick = toggleStyle
    }
}

var runTests2 = function (begin,end,nbegin,nend,maxMatch,maxOutput) {

    begin  = (begin || 2)
    end    = (end || 100)
    nbegin = (nbegin || 1)
    nend   = (nend || 1)
    maxMatch = (maxMatch || -1)
    maxOutput = (maxOutput || 10000)
    output = `<table cellspacing='0' cellpadding='2' border='1px'>
    <tr><th>Numer</th><th>Denom</th><th>Head<th>preMatch</th><th>RepLen</th>
    <th>MatchLen</th><th>Divide</th><th>Reduced</th><th>Factored</th><th>Result</th>
    </tr>`

    let bc,head,preMatch,matchLen,result,div,repLen,numer;
    let doNotReduce = true;
    let failed = false;
    let rational;
    let maxCounter = 0;
    bigloop:
    for (let n = nbegin;n<=nend;n++) {
        numer = n
        for (i=begin;i<=end;i++) {
            if (maxCounter >= maxOutput) {
                break bigloop;
            }
            denom = i
            bc = fractionToRecurringDecimal(n,denom,doNotReduce);
            rational = new Rational(numer,denom);
            matchLen = bc.matchLen
            result = bc.res
            head = bc.head
            preMatch = bc.preMatch
            repLen = bc.repLen
            div = bc.div
            if (bc.err != "" || bc.res == "") {
                errorClass = " ec"
            } else {
                errorClass = ""
            }
            output += `
        <tr id='r-${i}'><td>${numer}</td><td>${denom}</td>
            <td>${head}</td><td>${preMatch}</td><td>${repLen}</td>
            <td>${matchLen}</td>
            <td class='al${errorClass}'>${div}</td>
            <td >${rational.rationalValue}</td>
            <td >${rational.factoredValue}</td>
            <td class='al${errorClass}'>${result}</td>
        </tr>\n`
            maxCounter++
        }
    }
    document.getElementById('results').innerHTML = output
    setClickEvents(event);
}

var normInteger = function (inString) {
    let sign = (inString[0] == "-" ? -1 : 1)
    if (sign == -1) {
        inString = inString.substr(1)
    }
    let exp = inString.length
    let sd,sv;
    let i = exp-1; 
    while (i >= 0 && inString[i] == 0) {
        // loop
        i--
    }
    sv = inString.slice(0,i+1)
    sd = sv.length
    return {sign:sign,inString:inString,sv:sv,sd:sd,i:i,len:exp}
}

let normFloat = function(numer, denom) { // numer and denom both integers
    let sign, reducedFraction, reducedNumer, 
        reducedDenom, numExp,exponent,maxSigDig,
        denomFactors,numerFactors;

    let numerSign = (numer < 0 ? -1 : 1)
    let denomSign = (denom < 0 ? -1 : 1)
    let resultSign = numerSign * denomSign;

    denom *= denomSign;
    numer *= numerSign;

    numerFactors = factorInteger(numer)
    denomFactors = factorInteger(denom)
    reducedFraction = reduceFraction(numerFactors,denomFactors)



}

//console.log(runTests(testValues,12,20,6))
</script>
</head>
<body>
<div id="form-container">
<form action="" method="GET" id="form1">
<ul>
 <li>
    <label for="nb">Numerator Begin:</label>
    <input id="nb" name="nb" max="8888888888888888" type="number">
</li>
<li>
   <label for="ne">Numerator End:</label>
   <input id="ne" name="ne" type="number" max="8888888888888888">
</li>
<li>
   <label for="db">Denominator Begin:</label>
   <input id="db" name="db" type="number" max="88888888">
</li>
<li>
   <label for="de">Denominator End:</label>
   <input id="de" name="de" type="number" max="88888888">
</li>
<li>
   <label for="submit">Submit:</label>
   <input id="submit" name="submit" type="submit" value="Submit">
</li>
</ul>
</form>
</div>
<div id="results"></div>
<pre>
failing fractions:
 12953/50284 = 25759684989260997534006841142311669716013045899292 rf-calc = .25759684989261 actual = much longer...
 NOTE on Above: .2575968498926099 rounds to 25759684989261
 Need to start ignoring internal division 
</pre>
<script>

var queryValues = {
    nb: 1,
    ne: 1,
    db: 1,
    de: 1,
}

var processForm = function() {

    let url = document.URL;
    let query = url.split("?")[1]
    if (query) {
        let terms = query.split("&");
        let term;
        if (terms.length) {
            terms.forEach(element => {
                term = element.split("=")
                queryValues[term[0]] = term[1]
            });
        }
    }
    runTests2(queryValues.db,queryValues.de,queryValues.nb,queryValues.ne, 5000);
    nb.value = queryValues.nb;
    ne.value = queryValues.ne;
    db.value = queryValues.db;
    de.value = queryValues.de;
}

processForm()
</script>
</body>
</html>
