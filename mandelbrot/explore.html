<!DOCTYPE HTML>
<html lang="en-US">
<head>
<meta charset="utf-8">
<title>Mandelbrot Set Visualization</title>
<link rel="stylesheet" href="main-old.css" type="text/css">
<link rel="stylesheet" type="text/css" href="/css/log.css" media="all">
<link rel="stylesheet" type="text/css" href="css/mset.css" media="all">

<style id="colorStyles"></style>
<style>
#currentColors {
       display:none;
}
#log-parent {
       max-height:initial;
       position:relative;
}
#log2 {
       font-family:'Fira Code',monospace;
       overflow-x:initial;
       overflow-y:initial;
       max-height:initial;
}
#all {
       display:none;
}
#myCanvas {
       border: none;
       cursor:crosshair;
       position: absolute;
       top:5px;
       left:5px;
       
}
#main {
       height:initial;
       width:initial;
}
#captureMouseEvents {
    display: block;
    position: absolute;
    top:0;
    left:0;
    height:100px;
    width:100px;
    background-color:rgba(255,255,255,.1);
    border: 5px solid rgba(255,255,255,.1);
}
</style>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="/js/d3.v3.js"></script>
<script src="/js/decimal.js"></script>
<script src="/js/log-2.js"></script>
<script src="/js/data.js"></script>
<script src="/js/form-save-restore.js"></script>
<script src="/js/binary-hex-conversions.js"></script>
<script src="/js/example-library.js"></script>
<script src="/js/svg-transform.js"></script>
<script src="/js/schedule-function.js"></script>
<script src="js/precision.js"></script>
<script src="/js/mouse-events-4.js"></script>
<script src="/js/panel-show-hide.js"></script>
<script src="js/rect-init.js"></script>
<script src="js/mset.js"></script>
<script src="js/mset-form.js"></script>
<script src="js/mset-drawing.js"></script>
<script src="js/color-conversion.js"></script>
<script src="js/scale-counters.js"></script>
<script src="js/reference-colors.js"></script>
<script src="js/pixel-colors.js"></script>
<script src="js/pixel-functions.js"></script>
<script src="js/add-text.js"></script>
<script src="js/draw-colors.js"></script>
<script src="js/magnify-points.js"></script>
<script src="js/tent-map.js"></script>
<script src="js/mset-interactive.js"></script>
<script src="js/test-data.js"></script>

<script>

window.addEventListener('DOMContentLoaded', () => {

    //Log.Notice('Document Loading...');

    // this must be run before doing the restoreInput code below
    $('#controls .expand label')
        .click({rangeStyle:"width: 150px;",numberStyle:"width: 75px;"},
            Data.toggleFormInputType);

    // restore form values
    Data.restoreSelect('animationFunctionId');
    Data.restoreInput('fractalImageId');
    Data.restoreSelect('fractalTypeId');
    Data.restoreSelect('scaleTypeId');
    Data.restoreInput('maxWidth');
    Data.restoreInput('maxHeight');
    Data.restoreInput('timeout');
    Data.restoreInput('colorOffsetAmount');
    Data.restoreInput('pixelJump');
    Data.restoreSelect('pixelColorsId');
    Data.restoreSelect('refColorId');
    Data.restoreSelect('scaleCounterId');
    Data.restoreInput('hueFactor');
    Data.restoreInput('rampFactor');
    Data.restoreSelect('hslOrHsb');
    Data.restoreInput('minLevel');
    Data.restoreInput('maxLevel');
    Data.restoreInput('minSat');
    Data.restoreInput('maxSat');
    Data.restoreInput('minBrt');
    Data.restoreInput('maxBrt');
    Data.restoreInput('minInt');
    Data.restoreInput('maxInt');
    Data.restoreInput('finiteMeasure'); // may need decimal.js
    Data.restoreSelect('finiteMeasureFunction');
    Data.restoreSelect('pickedColor');
    Data.restoreInput('counterMax');

    myFractalImages[myFractalImageId] = new fractalImage('myCanvas',
                'box','captureMouseEvents',150,150,{colorCanvasId:'currentColors'});
   // myFractalImages[myFractalImageId] = new fractalImage('myCanvas',
    //            'box',35,35,{colorCanvasId:'currentColors'});
    myFractalImages[myFractalImageId].initColorArray();
    //myFractalImages[myFractalImageId].mouseBox = "#captureMouseEvents";
    bindMouseBox();
    //setTimeout("Log.Remove()", 20);
});
</script>
</head>
<body>
<div id="controls" >
<form onSubmit="return false;">
<fieldset>
<legend onClick="togglePanel('controls');">Options</legend>
<ul id="panel1">
<li>
 <label for="b1" id="buttonControl">Image:</label>
 <div id="drawImage">
  <button id="b1" onClick="drawImagePre('b4','b1');"
          value="Draw Image" >Draw</button>
  <button id="b4" onClick="reDrawImage();"
          value="ReDraw Image" >ReDraw</button>
 </div>
</li>
<li>
 <label for="fractalImageId">ImageId:</label>
 <input type="number" value="0" min="0" max="1"
        step="1" id="fractalImageId" name="fractalImageId"
        onChange="Data.saveInput('fractalImageId','Log.Notice')" />
</li>
<li>
  <label for="fractalTypeId">Fractal:</label>
  <select id="fractalTypeId" name="fractalTypeId"
          onChange="Data.saveInput('fractalTypeId','Log.Notice')" >
    <option value="0" selected="selected">M-Set</option>
    <option value="1" id="burning-ship" >Brn Ship</option>
    <option value="2" id="testing-pixels" >Test:10x10</option>
    <option value="3" id="testing-pixels-real" >Real</option>
    <option value="4" id="testing-pixels" >Test:100x100</option>
  </select>
</li>
<li>
  <label for="scaleTypeId">ScaleType:</label>
  <select id="scaleTypeId" name="scaleTypeId"
        onChange="Data.saveInput('scaleTypeId','Log.Notice')" >
    <option value="0,0" id="scale-0-0" selected="selected">H/W Ratio</option>
    <option value="1,0" id="scale-1-0">Pixel Width</option>
    <option value="0,1" id="scale-0-1" >Pixel Height</option>
    <option value="500,0" id="scale-500-0" >Width: 500</option>
    <option value="0,500" id="scale-0-500" >Height: 500</option>
    <option value="200,0" id="scale-200-0" >Width: 200</option>
    <option value="0,200" id="scale-0-200" >Height: 200</option>
    <option value="100,0" id="scale-100-0" >Width: 100</option>
    <option value="0,100" id="scale-0-100" >Height: 100</option>
    <option value="10,0" id="scale-10-0" >Width: 10</option>
    <option value="0,10" id="scale-0-10" >Height: 10</option>
  </select>
</li>
<li>
 <label for="maxWidth">Max W:</label>
 <input type="number" value="0" min="0" max="500"
        step="1" id="maxWidth" name="maxWidth"
        onChange="Data.saveInput('maxWidth','Log.Notice')" />
</li>
<li>
  <label for="maxHeight">Max H:</label>
  <input type="number" value="0" min="0" max="500"
         step="1" id="maxHeight" name="maxHeight"
         onChange="Data.saveInput('maxHeight','Log.Notice')" />
</li>
<li>
 <label for="finiteMeasure">+Infinity:</label>
 <input type="number" value="256" min=".5" max="8192"
        step=".1" id="finiteMeasure" name="finiteMeasure"
        onChange="Data.saveInput('finiteMeasure','Log.Notice')" />
</li>
<li>
 <label for="counterMax">Max Iter:</label>
 <input type="number" value="256" min="2" max="8192"
        step="1" id="counterMax" name="counterMax"
        onChange="Data.saveInput('counterMax','Log.Notice',' restored.')" />
</li>
<li>
 <label for="finiteMeasureFunction">Finite Fn:</label>
 <select id="finiteMeasureFunction"
         name="finiteMeasureFunction"
         onChange="Data.saveSelect('finiteMeasureFunction','Log.Notice')">
  <option value='1'>X^2 + Y^2</option>
  <option value='2'>SQRT(X^2 + Y^2)</option>
  <option value='3'>ABS(X*Y)</option>
  <option value='4'>ABS(X) + ABS(Y)</option>
  <option value='5'>ABS(X + Y)</option>
  <option value='6'>POW(ABS(X*Y),.75)</option>
  <option value='7'>Rect 1 (X || Y)</option>
  <option value='8'>Rect 2 (X && Y)</option>
  <option value='9'>Rect 3 (X && Y)</option>
  <option value='10'>CurrentPointMag</option>
 </select>
</li>
<li>
 <label for="b1">Animation:</label>
 <select id="animationFunctionId"
         name="animationFunctionId"
         onChange="Data.saveSelect('animationFunctionId','Log.Notice')">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
  <option value="10">10</option>
  <option value="11">BW</option>
  <option value="12">One</option>
  <option value="13">13</option>
  <option value="14">14</option>
  <option value="15">15</option>
  <option value="48">15.5</option>
  <option value="16">16</option>
  <option value="17">17</option>
  <option value="18">18</option>
  <option value="19">19</option>
  <option value="20">20</option>
  <option value="21">21</option>
  <option value="22">22</option>
  <option value="23">23: 3D 1</option>
  <option value="24">24: 3D 2</option>
  <option value="25" >25: 3D 3</option>
  <option value="26" >26: 3D 4 polygons</option>
  <option value="27">27: 3D 5 polygons by row 1</option>
  <option value="28">28: 3D 6 polygons by row 2</option>
  <option value="29">29: 3D 7 polygons by row 3</option>
  <option value="30">30: 3D 8 polygons by row 4</option>
  <option value="31">31: 3D 9 polygons by row 5</option>
  <option value="32">32: 3D 9 polygons by row 5</option>

  <option value="33">33</option>

  <option value="34">34</option>
  <option value="35">One Enhanced</option>
  <option value="36">One Enhanced2</option>
  <option value="37">37</option>
  <option value="38">38 3D Rotation</option>
  <option value="39">39</option>
  <option value="40">40</option>
  <option value="41">41</option>
  <option value="42">42</option>
  <option value="43">43</option>
  <option value="44">44 binary divide</option>
  <option value="45">45 binary divide 2</option>
  <option value="46">Binary Divide with color</option>
  <option value="47">43.5 (Alpha Adjust)</option>
 </select>
</li>

<li class="expand">
 <label for="timeout">Timer:</label>
 <div class="min-max">
 <span id="timeout-min"></span>
 <input type="number" value="70" min="10" max="400"
        step="10" id="timeout" name="timeout"
        onChange="Data.saveInput('timeout','Log.Notice');" />
 <span id="timeout-max"></span>
 </div>
</li>
<li class="expand">
 <label for="colorOffsetAmount">Step:</label>
 <div class="min-max">
 <span id="colorOffsetAmount-min"></span>
 <input type="number" value="1" min="-20" max="20"
        step="1" id="colorOffsetAmount" name="colorOffsetAmount"
        onChange="Data.saveInput('colorOffsetAmount','Log.Notice');" />
 <span id="colorOffsetAmount-max"></span>
 </div>
</li>
<li class="expand">
 <label for="pixelJump">Jump:</label>
 <div class="min-max">
 <span id="pixelJump-min"></span>
 <input type="number" value="4" min="4" max="2000"
        step="4" id="pixelJump" name="pixelJump"
        onChange="Data.saveInput('pixelJump','Log.Notice');" />
 <span id="pixelJump-max"></span>
 </div>
</li>
<li>
 <label for="pixelColorsId">Colors:</label>
  <select id="pixelColorsId" name="pixelColorsId"
          onChange="Data.saveSelect('pixelColorsId','Log.Notice');" >
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
  </select>
</li>
<li>
 <label for="refColorId">RefColId:</label>
  <select id="refColorId" name="refColorId"
          onChange="Data.saveSelect('refColorId','Log.Notice');" >
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2" >2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
  </select>
</li>
<li>
 <label for="scaleCounterId">Ht Scale:</label>
  <select id="scaleCounterId" name="scaleCounterId"
          onChange="Data.saveSelect('scaleCounterId','Log.Notice');" >
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
    <option value="9">9</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
  </select>
</li>
<li class="expand">
 <label for="hueFactor">HueFact:</label>
 <div class="min-max">
 <span id="hueFactor-min"></span>
 <input type="number" value="0.20" min="0.01" max="50.00"
        step="0.01" id="hueFactor" name="hueFactor"
        onChange="Data.saveInput('hueFactor','Log.Notice');" />
 <span id="hueFactor-max"></span>
 </div>
</li>
<li class="expand">
 <label for="rampFactor">RampFact:</label>
 <div class="min-max">
 <span id="rampFactor-min"></span>
 <input type="number" value="60" min="1" max="1500"
        step="1" id="rampFactor" name="rampFactor"
        onChange="Data.saveInput('rampFactor','Log.Notice');" />
 <span id="rampFactor-max"></span>
 </div>
</li>
<li>
 <label for="hslOrHsb">HSL/B/I:</label>
 <select id="hslOrHsb" name="hslOrHsb"
         onChange="Data.saveSelect('hslOrHsb','Log.Notice');" >
  <option value="hsl">HSL</option>
  <option value="hsb" selected="selected">HSB</option>
  <option value="hsi">HSI</option>
 </select>
</li>
<li class="expand">
 <label for="minLevel">MinLevel:</label>
 <div class="min-max">
 <span id="minLevel-min"></span>
 <input type="number" value="0.50" min="0.05" max="1.00"
        step="0.05" id="minLevel" name="minLevel"
        onChange="Data.saveInput('minLevel','Log.Notice');" />
 <span id="minLevel-max"></span>
 </div>
</li>
<li class="expand">
 <label for="maxLevel">MaxLevel:</label>
 <div class="min-max">
 <span id="maxLevel-min"></span>
 <input type="number" value="0.50" min="0.05" max="1.00"
        step="0.05" id="maxLevel" name="maxLevel"
        onChange="Data.saveInput('maxLevel','Log.Notice');" />
 <span id="maxLevel-max"></span>
 </div>
</li>
<li class="expand">
 <label for="minSat">MinSat:</label>
 <div class="min-max">
 <span id="minSat-min"></span>
 <input type="number" value="0.75" min="0.05" max="1.00"
        step="0.05" id="minSat" name="minSat"
        onChange="Data.saveInput('minSat','Log.Notice');" />
 <span id="minSat-max"></span>
 </div>
</li>
<li class="expand">
 <label for="maxSat">MaxSat:</label>
 <div class="min-max">
 <span id="maxSat-min"></span>
 <input type="number" value="0.85" min="0.05" max="1.00"
        step="0.05" id="maxSat" name="maxSat"
        onChange="Data.saveInput('maxSat','Log.Notice');" />
 <span id="maxSat-max"></span>
 </div>
</li>
<li class="expand">
 <label for="minBrt">MinBrt:</label>
 <div class="min-max">
 <span id="minBrt-min"></span>
 <input type="number" value="0.85" min="0.05" max="1.00"
        step="0.05" id="minBrt" name="minBrt"
        onChange="Data.saveInput('minBrt','Log.Notice');" />
 <span id="minBrt-max"></span>
 </div>
</li>
<li class="expand">
 <label for="maxBrt">MaxBrt:</label>
 <div class="min-max">
 <span id="maxBrt-min"></span>
 <input type="number" value="0.95" min="0.05" max="1.00"
        step="0.05" id="maxBrt" name="maxBrt"
        onChange="Data.saveInput('maxBrt','Log.Notice');" />
 <span id="maxBrt-max"></span>
 </div>
</li>
<li class="expand">
 <label for="minInt">MinInt:</label>
 <div class="min-max">
 <span id="minInt-min"></span>
 <input type="number" value="0.85" min="0.05" max="1.00"
        step="0.05" id="minInt" name="minInt"
        onChange="Data.saveInput('minInt','Log.Notice');" />
 <span id="minInt-max"></span>
 </div>
</li>
<li class="expand">
 <label for="maxInt">MaxInt:</label>
 <div class="min-max">
 <span id="maxInt-min"></span>
 <input type="number" value="0.95" min="0.05" max="1.00"
        step="0.05" id="maxInt" name="maxInt"
        onChange="Data.saveInput('maxInt','Log.Notice');" />
 <span id="maxInt-max"></span>
 </div>
</li>
<li>
  <label for="scaleH">ScaleH:</label>
  <input type="checkbox" name="scaleH"
         id="scaleH" value="-1"
         onChange="doScale('scaleH','scaleV')"/>
</li>
<li>
  <label for="scaleV">ScaleV:</label>
  <input type="checkbox" name="scaleV"
         id="scaleV" value="-1"
         onChange="doScale('scaleH','scaleV')"/>
</li>
<li>
 <label for="b2" id="buttonControl2">Animate:</label>
 <div id="animateImage">
  <button id="b2" onClick="startAnimationPre()"
          value="Start Animation" >Start</button>
  <button id="b3" onClick="stopAnimation();"
          value="Stop Animation" >Stop</button>
 </div>
</li>
<li>
 <label for="pickedColor">Pick Color</label>
 <select id="pickedColor" name="pickedColor"
         onChange="Data.saveSelect('pickedColor','Log.Notice');" >

 </select>
</li>
<li>
 <label for="b5" id="buttonControl4">Capture:</label>
 <div id="captureCanvas">
 <button id="b5" name="b5" onClick="captureCanvas2('image/png')"
         value="Canvas to PNG" >PNG</button>
 </div>
</li>

</ul>
</fieldset>
</form>
</div>

<div id="main"><canvas id="myCanvas" height="100" width="100"></canvas><div 
       id="box"
    ></div><div id="captureMouseEvents"></div></div>



<!-- you can add an additional canvas like this:
<div id="main2">
 <canvas id="myCanvas2"
         height="0" width="0">Your browser doesn't support canvas</canvas>
 <div id="box2"></div>
</div>
-->
<div id="colors">
 <canvas id="currentColors"
         height="0" width="0">Your browser doesn't support canvas</canvas>
</div>
<div id="pickContainer"></div>
<div id="imageGallery"></div>
<div id="gridAlignment">
<svg id="all"
  xmlns:svg="http://www.w3.org/2000/svg"
  xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  x="-20"
  y="-20"
  width="2050"
  height="2050"
  viewBox="-20 -20 2050 2050"
  shape-rendering="geometricPrecision"
  text-rendering="geometricPrecision"
  image-rendering="optimizeQuality"
  fill-rule="evenodd"
  clip-rule="evenodd">
<style>
#all {
    background-color: white;
    stroke:#888;
}
#pointsContainer rect,
#pointsContainer circle,
#pointsContainer use {
    stroke-width: 0.25;
    stroke: #800;
}
#grid-old line {
    stroke-dasharray:  18 2;
    stroke-dashoffset:   -1;
    stroke-width:      0.25;
    stroke-linecap:   miter;
}
#grid line {
    stroke-dasharray:  1 19;
    stroke-dashoffset:   -5.75;
    stroke-width:      250%;
    stroke-linecap:   miter;
    stroke: rgba(0,0,0,0.5);
}
#point-def-rect {
    height:18;
    width:18;
}

#coordsContainer text {
    stroke: none;
    fill: black;
    font-family:"Fira Code";
}

</style>
<defs id="svg-defs">

<g id="grid" >
  <line x1="-10%" y1="-10%" x2="110%" y2="-10%"></line>
</g>
<g id="grid-v" >
<!--  This works, but need to investigate full extent of line  -->
 <use xlink:href="#grid" transform="rotate(90,0,0) translate(0,-220)" />
</g>
<g id="whole-grid" x="-10" y="-10">
  <use xlink:href="#grid" />
  <use xlink:href="#grid-v" />
</g>
<circle id="point-def-circle" class="point" r="0.5" />
<rect   id="point-def-rect" height="18" width="18" />
</defs>
<use id="complete-grid" xlink:href="#whole-grid" />

<g x="0" y="0" id="pointsContainer" transform="scale(1)">

</g>
<g x="0" y="0" id="coordsContainer" transform="scale(1)">
 <rect id="bg-rect" height="80" width="220" fill="white"/>
 <text x="2" y="15" id="x-coord" >X:</text>
 <text x="2" y="35" id="y-coord" >Y:</text>
 <text x="2" y="55" id="polarity" >P:</text>
 <text x="2" y="75" id="iter-count" >C:</text>

</g>
</svg>

</div>
<script>
//var recordedChunks = [];
//var options = {mimeType: 'video/webm; codecs=vp9'};
//mediaRecorder = new MediaRecorder(stream, options);     
</script>
</body>
</html>
