<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Generalized Complex Multiplication</title>

    <link rel="stylesheet" type="text/css" href="/css/log.css" media="all" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/js/jQuery.UI.Combined.1.8.20.1/Content/Content/themes/base/jquery.ui.all.css"
    />

    <style></style>

    <script src="/js/jquery-1.7.1.js"></script>
    <script src="/js/jQuery.UI.Combined.1.8.20.1/Content/Scripts/jquery-ui-1.8.20.js"></script>
    <script src="/js/d3.v3.js"></script>
    <script src="/js/log-2.js"></script>
    <script src="/js/data.js"></script>
    <script src="/js/form-save-restore.js"></script>
    <script src="/js/binary-hex-conversions.js"></script>
    <script src="/js/example-library.js"></script>
    <script src="/js/svg-transform.js"></script>
    <script src="/js/schedule-function.js"></script>
    <script src="/js/mouse-events.js"></script>

    <script>
      $(document).ready(function(e) {
        Log.Notice("Document Ready");
      });

      var r, s;
      r = 4;
      s = 5;
      var complex = (r + s) * (r + s);
      var complex2 = r * r + 2 * r * s + s * s;
      var complex3 = complex2 * (r + s);
      var complex4 =
        r * r * r +
        2 * r * s * r +
        r * s * s * +r * r * s +
        2 * r * s * s +
        s * s * s;
      var complex5 = r * r * r + 3 * r * r * s + 3 * r * s * s + s * s * s;
      // (r +si) * (r + si) = r*r + rsi + rsi + s*s*i*i
      // i*i = -1
      // == r*r + 2*r*s*i - s*s
      // (r*r + 2*r*s*i - s*s) * (r + si)
      // == r*r*r + r*r*s*i + 2*r*r*s*i + 2*r*s*s*i*i - s*s*r - s*s*s*i
      // == rrr + 3rrsi - 2rss - rss - sssi
      // == rrr + 3rrsi - 3rss - sssi
      // == (rrr - 3rss) + (3rrs - sss)i
      // (rr + 2rsi - ss)(rr + 2rsi - ss)
      // rrrr + 2rrrsi - rrss + 2rrrsi + 4rrssii - 2rsssi - rrss - 2rsssi + ssss
      // rrrr + 4rrrsi -6rrss -4rsssi + ssss
      // = (rrrr -6rrss + ssss) + 4(rrrs - rsss)i
    </script>

<script>

var currentReal = 0.0;
var currentImag = 0.0;
var X = 0.0; // Real component
var Y = 0.0; // Imaginary component
var currentIter = 0;
var currentDist = 0;
var infinite = 4.0;
var maxIterations = 100; // max iterations per round;
var loopFunctionId = 0;

var writeTableRow = function (targetId) {

  var row = "  <tr>\n"
  row = row + "   <td>" + currentIter + "</td>\n"
  row = row + "   <td>" + currentReal + "</td>\n"
  row = row + "   <td>" + currentImag + "</td>\n"
  row = row + "   <td>" + currentDist + "</td>\n"
  row = row + " </tr>"

  $('#' + targetId)
    .append(row);
}

var iterate = function(targetId) {
  var real,imag;
  if (currentIter == 0) {
    real = parseFloat($('#real').val());
    imag = parseFloat($('#imaginary').val());
    loopFunctionId = parseInt($('#loopFunctionId').val());
    X = real;
    Y = imag;
    currentReal = real;
    currentImag = imag;
    currentDist = real * real + imag * imag;
    writeTableRow(targetId);
  } else {
    real = currentReal;
    imag = currentImag;
  }

  var iterations = parseInt($('#iterations').val());
  if (iterations > maxIterations) iterations = maxIterations;

  loopFunction[loopFunctionId](targetId, iterations);
}

var polar = function(targetId, iterations) {
  var exponent = 2;
  var real = currentReal;
  var imag = currentImag;
  var dist;
  var r2p;

  var tan0 = imag/real;
  var i = 0;
  var tmpReal = real;
  var tmpImag = imag;
  var rr = tmpReal*tmpReal;
  var ss = tmpImag*tmpImag;
  if (tmpReal == 0) {
    currentDist = Math.abs(tmpImag);
  } else {
    currentDist = rr + ss;
  }

  while (i <= iterations && infinite > currentDist) {
    if (tmpReal == 0) {
      dist = Math.abs(tmpImag);
      imag = Y + Math.pow(dist, exponent);
      real = X - tmpImag; // something not right here
    } else {
      dist = Math.sqrt(rr + ss);
      tan0 = tmpImag/tmpReal;
      angl = Math.atan(tan0);
      r2po = Math.pow(dist,exponent);
      axpo = angl*exponent
      real = X + r2po*Math.cos(axpo);
      imag = Y + r2po*Math.sin(axpo);
    }
    i++;
    tmpReal = real;
    tmpImag = imag;
    rr = tmpReal*tmpReal;
    ss = tmpImag*tmpImag;
    if (tmpReal == 0) {
      currentDist = Math.abs(tmpImag);
    } else {
      currentDist = rr + ss;
    }
    currentReal = real;
    currentImag = imag;
    currentIter++;
    writeTableRow(targetId);
  }
}

var zquad = function(targetId, iterations) {
  // (r(rr - 3ss) + s(3rr - ss)i ) * (r + si)
  // (rrr + 3rrsi - 3rss - sssi) * (r + si)
  // rrrr + 3rrrsi - 3rrss - rsssi + rrrsi - 3rrss - 3rsssi + ssss
  // rrrr - 3rrss - 3rrss + ssss + 3rrrsi -rsssi + rrrsi - 3rsssi
  // rr(rr - 3ss) + ss(ss - 3rr) + rs((3rr - ss) + (rr - 3ss))i
  // rr(rr - 3ss) + ss(ss - 3rr) + rs(4rr -4ss)i
  // (rrrr + ssss - 6rrss) + 4rs(rr - ss)i
  // compare
  // (rrrr -6rrss + ssss) + 4(rrrs - rsss)i

  var real = currentReal;
  var imag = currentImag;
  var i = 0;
  var tmpReal = real;
  var tmpImag = imag;
  var rr = tmpReal * tmpReal;
  var ss = tmpImag * tmpImag;
  var rs = tmpReal * tmpImag;

  while (i <= iterations && infinite > currentDist) {
    imag = Y + 4*rs*(rr - ss)
    real = X + rr*rr - 6*rr*ss + ss*ss;
    tmpReal = real;
    tmpImag = imag;
    rr = tmpReal * tmpReal;
    ss = tmpImag * tmpImag;
    rs = tmpReal * tmpImag;
    i++;
    // update output variables
    currentDist = rr + ss;
    currentIter++;
    currentReal = real;
    currentImag = imag;
    writeTableRow(targetId);
  }
}
var zcubed = function(targetId, iterations) {
  // rrr + 3rrsi - 3rss - sssi
  // r(rr - 3ss) + s(3rr - ss)i
  var real = currentReal;
  var imag = currentImag;
  var i = 0;
  var tmpReal = real;
  var tmpImag = imag;
  var rr = tmpReal * tmpReal;
  var ss = tmpImag * tmpImag;

  while (i <= iterations && infinite > currentDist) {
    imag = Y + tmpImag * (3*rr - ss);
    real = X + tmpReal * (rr - 3*ss);
    tmpReal = real;
    tmpImag = imag;
    rr = tmpReal * tmpReal;
    ss = tmpImag * tmpImag;
    i++;
    // update output variables
    currentDist = rr + ss;
    currentIter++;
    currentReal = real;
    currentImag = imag;
    writeTableRow(targetId);
  }
}

var mset1 = function (targetId, iterations) {
  var real = currentReal;
  var imag = currentImag;
  var i = 0;
  var tmpReal = real;
  var tmpImag = imag;
  var tmpRealSquared = (tmpReal*tmpReal);
  var tmpImagSquared = (tmpImag*tmpImag);

  while (i <= iterations && infinite > currentDist) {
    imag = Y + 2 * (tmpReal*tmpImag);
    real = X - tmpImagSquared + tmpRealSquared;
    tmpReal = real;
    tmpImag = imag;
    tmpRealSquared = tmpReal*tmpReal;
    tmpImagSquared = tmpImag*tmpImag;
    i++;
    // update output variables
    currentDist = (tmpRealSquared + tmpImagSquared);
    currentIter++;
    currentReal = real;
    currentImag = imag;
    writeTableRow(targetId);
  }
}

var loopFunction = new Array();


loopFunction[loopFunction.length] = mset1;
loopFunction[loopFunction.length] = zcubed;
loopFunction[loopFunction.length] = zquad;
loopFunction[loopFunction.length] = polar;

var resetEverything = function(targetId) {
    currentIter = 0;
    currentDist = 0;
    currentReal = 0;
    currentImag = 0;
    X = 0;
    Y = 0;
    $('#' + targetId).html('');
}

</script>
  </head>

  <body>
    <form onsubmit="return false;" id="form1">
    <ul>
    <li>C Real: <input value="0.0" size="30" id="real" name="real" />
        C Imaginary: <input value="0.0" size="30" id="imaginary" name="imaginary" />
    </li>
    <li>Iterations Per Click: <input type="number" size="30" id="iterations" name="iterations" />
    </li>
    <li>Function:
      <select id="loopFunctionId" name="loopFunctionId">
        <option value="0">Mandelbrot Set</option>
        <option value="1">z = z^3 + c</option>
        <option value="2">z = z^4 + c</option>
        <option value="3">z = z^n + c (cis)</option>
      </select>
    </li>
    <li>
      <button onClick="iterate('output')">Iterate</button>
      <button onClick="resetEverything('output');">Reset</button>
    </li>
  </ul>
      <div id="result">
        <table rowspacing="0" rowpadding="2" border="1">
          <thead>
          <tr>
            <th>Iteration</th>
            <th>Z Real</th>
            <th>Z Imaginary</th>
            <th>Distance^2</th>
          </tr>
        </thead>
        <tbody id="output"></tbody>
        </table>
      </div>
    </form>
  </body>
</html>
