File Upload Vulnerability

Description:

ns_queryget creates temporary files of uploaded data. It also adds new 
variables to the ns_set which holds the querystring variables.
If the file widget variable namewas 'myvar', a new variable 'myvar.tmpfile' 
is added to the ns_set having the value of the path and filename of the newly 
created file.

An attacker can submit a plain form holding similarly named variables, where
myvar.tmpfile contains the absolute path and file of any file readable by
the AOLserver user.

AOLserver also chooses a temporary directory that is world writeable. This allows
a local attacker to make a symbolic link to any file to a file in this temp 
directory. If the symbolic link works for the AOLserver user, the form processing
code would need to verify the file is not a link:

if {[string match "link" [file type name]]} {
   barf
}

Replacement functions. The function that parses the querystring and places the result
into an Ns_Set has changed from version 3.4.2 to 4.0. 

3.4.2 -- Replace QueryToSet in nsd/conn.c

4.0   -- Replace ParseQuery in nsd/form.c

Note that ns_queryget creates a new variable by appending the ascii text .tmpfile to
the variable name. This might not work with all encodings. This fix also does not take
into account different encodings. It might still miss a hack attempt.

--Tom Jackson