<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Untitled Document</title>
<link rel="stylesheet" type="text/css" href="/css/log.css" media="all">
<link rel="stylesheet" type="text/css" href="/js/jQuery.UI.Combined.1.8.20.1/Content/Content/themes/base/jquery.ui.all.css" >

<style>
#svg1 {
    position: absolute;
    top: 100px;
    left: 100px;
    border: solid black 1px;
    zoom: 1.0;
    fill: #444;
}

.c1 {
    fill: green;
}

.c1-under {
    fill: green;
    z-index: -1000;
}

.c2 {
    fill: grey;
}
.c2-under {
    fill: grey;
    z-index: -1000;
}
.c3 {
    fill: red;
}
.c3-under {
    fill: red;
    z-index: -1000;
}
.c4 {
    fill: tan;
}
.c4-under {
    fill: tan;
    z-index: -1000;
}

</style>
<script type="text/javascript" src="/js/jquery-1.7.1.js"></script>
<script type="text/javascript" 
 src="/js/jQuery.UI.Combined.1.8.20.1/Content/Scripts/jquery-ui-1.8.20.js"></script>
<script type="text/javascript" src="/js/log-2.js"></script>
<script src="/js/d3.v3.js"></script>


<script>

var tiles = 10;
var row = 0;
var col = 0;
var start = 0;
var svg;
var dataset;
	
var Tartan = {
	threadX: 0,
	threadY: 0,
	currentPixelX: 0,
	currentPixelY: 0,
	side: 4,
	end: 2,
	threadCount: 0,
	
	currentClass: null,
	h2: function (g) {
		g.append("rect")
		 .attr("class", this.currentClass)
		 .attr("height", this.end)
		 .attr("width", this.side)
		 .attr("x", this.currentPixelX)
		 .attr("y", this.currentPixelY);
		
		this.currentPixelX = this.currentPixelX + this.side;
		this.threadX = this.threadX + 2;
	},
	d2: function (g,colorArray) {
		g.append("rect")
		 .attr("class", colorArray[this.threadX])
		 .attr("height", this.side)
		 .attr("width", this.end)
		 .attr("x", this.currentPixelX)
		 .attr("y", this.currentPixelY);
		 
		this.currentPixelX = this.currentPixelX + this.end;
		this.threadX = this.threadX + 1;
	},
	u2: function (g,colorArray) {
		g.append("rect")
		 .attr("class", colorArray[this.threadX])
		 .attr("height", this.side)
		 .attr("width", this.end)
		 .attr("x", this.currentPixelX)
		 .attr("y", this.currentPixelY - this.side/2);
		 
		this.currentPixelX = this.currentPixelX + this.end;
		this.threadX = this.threadX + 1;
	},
	s1: function () {
	  this.currentPixelX = this.currentPixelX + this.end;
		this.threadX = this.threadX + 1;
	},
	h1: function (g, firstLoop) {
		g.append("rect")
		 .attr("class", this.currentClass)
		 .attr("height", this.end)
		 .attr("width", this.side)
		 .attr("x", this.currentPixelX - this.side/2)
		 .attr("y", this.currentPixelY);
		
		this.currentPixelX = this.currentPixelX + this.side/2;
		this.threadX = this.threadX + 1;
		firstLoop = false;
	},
	threadOne: function (svg, colorArray) {
		var g = svg.append("g")
			.attr("id", "row-" + this.threadY);
		while (this.threadX < colorArray.length) {
			Log.Notice("threadX=" + this.threadX);
			this.h2(g);
			if (this.threadX >= colorArray.length) {break;}
			this.d2(g, colorArray);
			if (this.threadX >= colorArray.length) {break;}
			this.u2(g, colorArray);
		}
	},
	threadTwo: function (svg, colorArray) {
		var g = svg.append("g")
			.attr("id", "row-" + this.threadY);
    var firstLoop = true;
		while (this.threadX < colorArray.length) {
			/*if (firstLoop == true) { this.h1(g, firstLoop);} else {this.h2(g);} */
			this.h2(g);
			if (this.threadX >= colorArray.length) {break;}
			this.d2(g, colorArray);
			if (this.threadX >= colorArray.length) {break;}
			this.s1();
		}
	},
	threadThree: function (svg, colorArray) {
		var g = svg.append("g")
			.attr("id", "row-" + this.threadY);
		while (this.threadX < colorArray.length) {
			this.d2(g, colorArray);
			if (this.threadX >= colorArray.length) {break;}
			this.s1();
			if (this.threadX >= colorArray.length) {break;}
			this.h2(g);
		}
	},
	threadFour: function (svg, colorArray) {
		var g = svg.append("g")
			.attr("id", "row-" + this.threadY);
		while (this.threadX < colorArray.length) {
			this.s1();
			if (this.threadX >= colorArray.length) {break;}
			this.h2(g);
			if (this.threadX >= colorArray.length) {break;}
			this.d2(g, colorArray);
		}
	},
	weave: function (colorArray) {
	
	 svg = d3.select(document.body)
  	.append("svg")
		.attr('id','svg1')
		.attr('height', this.threadCount)
		.attr('width', this.threadCount);
		
		Log.Notice("colorArray.length=" + colorArray.length);
		while (this.threadY < colorArray.length) {
			Log.Notice("threadY=" + this.threadY);
			
			this.threadX = 0;
			this.currentPixelX = 0;
			this.currentClass = colorArray[this.threadY];
			this.threadOne(svg,colorArray);
			this.threadY++;
			if (this.threadY >= colorArray.length) {break;}
			this.currentPixelY = this.currentPixelY + this.end;
			
			this.threadX = -1;
			this.currentPixelX = 0 - this.side/2;
			this.currentClass = colorArray[this.threadY];
			this.threadTwo(svg,colorArray);
			this.threadY++;
			if (this.threadY >= colorArray.length) {break;}
			this.currentPixelY = this.currentPixelY + this.end;
			
			this.threadX = 0;
			this.currentPixelX = 0 ;
			this.currentClass = colorArray[this.threadY];
			this.threadThree(svg,colorArray);
			this.threadY++;
			if (this.threadY >= colorArray.length) {break;}
			this.currentPixelY = this.currentPixelY + this.end;
			 
			this.threadX = 0;
			this.currentPixelX = 0;
			this.currentClass = colorArray[this.threadY];
			this.threadFour(svg,colorArray);
			this.threadY++; 
			this.currentPixelY = this.currentPixelY + this.end;
		}
	},
	writeStyle: function (styleArray) {
		var style = "";
		for (var i = 0; i<styleArray.length; i++) {
			var color = styleArray[i][1];

			style += "\n\n." + styleArray[i][0] + "\{\nfill: " + color + ";\n\}\n";
		}
		
		d3.select(document.body)
			.append("style")
			.text(style);
	},
	init: function (inputArray, outputArray, styleArray, threadsToWeave) {
		expandColorArray(inputArray, outputArray, styleArray);
		Log.Notice("outputArray=" + outputArray);
		this.threadCount = outputArray.length;
		if (arguments.length == 4) { 
			this.threadsToWeave = threadsToWeave;
		} else {
			this.threadsToWeave = this.threadCount;
		}
		
		this.writeStyle(styleArray);
		
		this.weave(outputArray);
	}
	
};
	
function expandColorArray(inArray, outArray, styleArray) {
		var index = 0;

		for (var i = 0; i<inArray.length; i++) {
			var color = inArray[i][0];
			var repeat = inArray[i][1];
			var found = false;
			var styleId;
			for (var k = 0; k < styleArray.length; k++) {
				if (styleArray[k][1] == color) {
					found = true;
					styleId = styleArray[k][0];
					break;
				}
			}
			if (!found) {
				styleId = "c" + styleArray.length;
				styleArray[styleArray.length] = [styleId, color];
			}
			for (var j = 0; j < repeat; j++) {
				outArray[index] = styleId;
				index++;
			}
		}
		
		// add reversed array
		for (var i = outArray.length -1; i >= 0; i--) {
			outArray[index] = outArray[i];
			index++;
		}
		Log.Notice("finished expandColorArray");
	}
	
$(document).ready(function() {

	dataset = [["green", 2], ["grey", 2], ["red", 4], ["grey", 2], ["tan", 6]];
	dataset = [["black", 1], ["green", 2], ["orange", 1], ["green", 24], ["black", 12],
		["darkblue", 16], ["black", 2]];
	dataset2 = [["blue", 2], ["grey", 2], ["red", 4], ["grey", 8], ["green", 8]];
	var orange = "orange";
	var black = "black";
	var dkgreen = "darkgreen";
	var white = "white";
  var slateblue = "slateblue";
	var red = "red";
	var yellow = "yellow";
	var blue = "blue";
	// MACFARLANE
	var dataset3 = [
		[orange, 48], [black, 8], [dkgreen, 16], [white, 4], [orange, 12],
		[black, 2], [orange, 12], [white, 4], [dkgreen, 6], [slateblue, 48],
		[black, 16], [orange, 16], [white, 12], [dkgreen, 2]
		];
		// MACLEOD OF ARGENTINA
	var dataset4 = [
		[red, 4], [yellow, 32], [blue, 24], [white, 6], [blue, 18]
	];
	var datasetExp = new Array();
	var dsStyleArray = new Array();

	// expand datasets 
	

  Tartan.init(dataset4, datasetExp, dsStyleArray, 150);
	
	//expandColorArray(dataset, datasetExp, dsStyleArray);
	//expandColorArray(dataset2, dataset2Exp, dsStyleArray2);

	
});

 Log.Hide();
</script>

</head>
<body>

</body>
</html>
