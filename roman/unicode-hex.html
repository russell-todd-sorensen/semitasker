<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Display a Range of Unicode Characters Hexidecimal Numbering</title>

<link rel="stylesheet" type="text/css" href="/css/log.css" media="all">

<style>

#chars td,
#chars th {
    width: 100px;
    height: 2em;
    font-family: "consolas sans unicode";
    font-size: 1.5em;
    text-align: center;
    border: .5px solid black;
    border-collapse: collapse;
    padding: 2px;
    vertical-align: middle;
    border-spacing: 0;
}

#chars {
    border-spacing: 0;
    border-collapse: collapse;
}
.heading {
    font-weight: bold;
    text-align: center;
}

.detail {
    font-weight: normal;
    text-align: center;
}
.detail:hover {
    background-color: silver;
}

fieldset {
    display: inline-block;
}

#top {
    width: 100%;
}

#left {
    width: 95%;
    display: inline-block;
    vertical-align: top;
}
#right {
    width: 0%;
    display: inline-block;
    vertical-align: top;
    height: 100vh;
}
#uni-lookup {
    width: 100%;
    position:fixed;
    top:10px;
    height: 100vh;
}
</style>

<style id="dynamic">

</style>


<script type="text/javascript" src="/js/d3.v4.js"></script>
<script type="text/javascript" src="/js/jquery-1.7.1.js"></script>
<script type="text/javascript" src="/js/jQuery.UI.Combined.1.8.20.1/Content/Scripts/jquery-ui-1.8.20.js"></script>
<script type="text/javascript" src="/js/log-2.js"></script>

<script>

var HexTable = new Array();
var HexValue = new Array();
var HexDigits = "0123456789ABCDEF";

var setupHexData = function() {
    var hexChar;
    for (var i = 0; i < 9; i++) {
        HexTable[i] = Math.pow(16,i);
    }

    for (var i in HexDigits.split('')) {
        hexChar = HexDigits[i]
        HexValue[hexChar] = i;
        HexValue[hexChar.toLowerCase()] = i;
    }
}

var toDecimal = function (hexNumber) {
    var hexDigits = hexNumber.split('');
    var val = parseInt(0);
    for (var i in hexDigits) {
        val = val * 16 + parseInt(HexValue[hexDigits[i]])
    }
    return val;
}

var toHex2 = function(decimalNumber) {
    //decimalNumber =< 1,114,111 , Hex <= 10FFFF
    //table of values
    var hexChars = "0123456789ABCDEF";
    decimalNumber = parseInt(decimalNumber);
    var result = ""
    var v
    var H = new Array(9);
    var firstNonZero = 0;
    for (var i = 8; i >= 0; i--) {
        v = Math.floor(decimalNumber / HexTable[i])
        H[i] = v;
        //console.log('H[' + i + ']=' + v);
        if (v > 0) {
            firstNonZero = 1;
            decimalNumber -= (H[i] * HexTable[i])
        }
        if (H[i] == 0) {
            if (firstNonZero == 1) {
                result = result + hexChars.charAt(H[i]);
            }
        } else {
            result = result + hexChars.charAt(H[i]);
        }
    }

    return (result == "" ? "0" : result)
}

var showUnicodeChars = function(startId, endId, baseId) {

    var base = parseInt($('#' + baseId + ':checked').val());
    var startCode, endCode, tmpCode,char;

    startCode = $('#' + startId).val();
    endCode   = $('#' + endId).val();

    if (base == 16) {
        startCode = toDecimal(startCode);
        endCode = toDecimal(endCode);
    } else {
        startCode = parseInt(startCode);
        endCode   = parseInt(endCode);
    }

    if (startCode > endCode) {
        tmpCode = parseInt(0) + parseInt(endCode);
        endCode = parseInt(0) + parseInt(startCode);
        startCode = parseInt(0) + parseInt(tmpCode);
    }

    var charArray = new Array();

    $('#thead').html("");
    $('#tbody').html("");

    for (var i=startCode;i<=endCode;i++) {
        charArray[i] = String.fromCharCode(i);
    }

    var startNumber = base*Math.floor(startCode/base);

    // table header
    var header = "<tr>"
    header = header + "<th class='detail'>Base</th>";

    for (var i=0;i<base;i++) {
        header = header + "<th class='heading'>" + toHex2(i) + "</th>";
    }
    header = header + "</tr>\n"

    $('#thead').append(header);

    // table body
    var tableBody = "<tr>";
    var cellValue,hexValue;
    if (base == 16) {
        cellValue = toHex2(startNumber)
        hexValue = cellValue;
    } else {
        cellValue = startNumber;
        hexValue = toHex2(cellValue);
    }
    tableBody = tableBody + "<th class='heading'>" + cellValue + "</th>";

    for (var i=startNumber;i < startCode;i++) {
        tableBody = tableBody + "<td class='detail'>&nbsp;</td>";
    }

    for (var i=startCode,j=(startCode-startNumber),t=5;i<=endCode;i++,j++,t++) {
        if ((j>0) && ((j%base) == 0)) {
            if (base == 16) {
                cellValue = toHex2(startNumber + j);
            } else {
                cellValue = (startNumber + j);
            }
            tableBody = tableBody + "</tr>\n<tr><th class='heading'>" + cellValue + "</th>"
        }
        hexValue = toHex2(i)
        while (hexValue.length < 4) {
            hexValue = "0" + hexValue
        }
        tableBody = tableBody + "<td class='detail' data-unicode='" + hexValue + "' tabindex='" + t + "'>" + charArray[i] + "</td>"
    }
    tableBody = tableBody + "</tr>\n"
    $('#tbody').html(tableBody);

    addClickLinks();
}

var addClickLinks = function() {
    var divs = document.getElementsByClassName('detail');
    var div;
    for (i in divs) {
        divs[i].onclick = loadWebPage
    }
}

var loadWebPage = function (evt) {
    var data = evt.currentTarget.dataset.unicode;
    var url = 'https://www.compart.com/en/unicode/U+' + data;
    Log.Notice('data=' + data + ' url=' + url);
    //$('#uni-lookup').attr('src',url);
    subWindow = window.open(
        url,  // url to open
        "unicode", // window name
        "height=500,width=700,toolbar=yes,menubar=yes,scrollbars=yes,resizable=yes,chrome=true,titlebar=true", // options
        "true" // replace (removes current document)
   );
}

$(document).ready(function() {
  Log.Notice('Document Ready');
  //Log.Remove();
  setupHexData();
 });

</script>

</head>

<body>
<div id="top">
<div id="left">
<form id="form1" onSubmit="return false;">
    Start: <input type="text" value="20" pattern="[0-9A-Fa-f]*" id="start" name="start" size="10" placeholder="Enter starting unicode number">
    End: <input type="text" value="512" pattern="[0-9A-Fa-f]*"  id="end" name="end" size="10" placeholder="Enter ending unicode number">
    <fieldset>
    Hex: <input type="radio" value="16" name="base" id="base" checked="checked">
    Decimal: <input type="radio" value="10" name="base" id="base" >
    </fieldset><br>
    <button id="doit" name="doit" onClick="showUnicodeChars('start','end','base')">Show Unicode Chars</button>
</form>
<table id="chars">
<thead id="thead">

</thead>
<tbody id="tbody">

</tbody>
</table>
</div>
</div>
</body>
</html>
