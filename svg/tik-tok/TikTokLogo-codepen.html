<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>TikTok Text</title>

<link rel="stylesheet" type="text/css" href="/css/log.css" media="all">
<link rel="stylesheet" href="/css/fonts.css" media="all" >
<style>

svg {
    display: block;
    font-family: "Stalinist One";
    shape-rendering: geometricPrecision;
    text-rendering: geometricPrecision;
    image-rendering: optimizeQuality;
}

#base {
    background-color: white;
}

#text-input {
    display: inline-block;
    width: 363px;
    font-family: 'Days One';
    font-size: 3em;
    height: .95em;
    padding-top: 0;
    padding-bottom: 5px;
}

#white-to-black {
    display: inline-block;
    width: 55px;;
    height: 1.39em;
    font-size: 2.5em;
    font-family: 'Days One';
    background-color: white;
    padding-left: 3px;
    vertical-align: top;
}

form {
    padding-top: 5px;
    padding-bottom: 5px;
}
#svg1 {
    margin-top: 5px;
}
#svg2,
#svg3 {
    display: inline-block;
    vertical-align: top;
}

#svg3 {
    fill: black;
}

#svg3 #tik-tok-bg {
    stroke-width: 3px;
    stroke: silver;
}

#top-container {
    background-color: #444;
    width: 438px;
    padding-left: 5px;
}
</style>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous" defer></script>
<script src="/dsvg/js/fonts.js" defer></script>
<script src="/js/d3.v3.js" defer></script>
<script src="/dsvg/devel/mouse-wheel.js" defer></script>
</head>
<body>

<div id="top-container">

<form id="form1" onsubmit="return false;" spellcheck="false">
  <input id="text-input"
    name="text-input"
    value="TikTok Text&#x1D160;"
    onkeyup="updateText(...updateIds);"
    onchange="updateText(...updateIds);"
    onclick="updateText(...updateIds);"/>
   <button id="white-to-black" value="white" onClick="toggleWtoB('white-to-black');return false;" >W</button>
</form>

<svg
    id="svg2"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    xml:base="https://home.semitasker.com/"
    externalResourcesRequired="true"
    x="0"
    y="0"
    width="310"
    height="147"
    viewport="0 0 310 147"
    >
<style>
#t2 {
    font-size: 48px;
    fill: black;
    font-family: 'Keania One', Arial;
}

#svg-scroller {
    fill: silver;
    cursor: pointer;
    font-family: 'Days One';
    font-size: 20px;
}

#scroller-1,
#scroller-2 {
    fill: black;
    stroke-width: 3px;
    stroke: silver;
}

#scroll-value {
    font-family: 'Days One';
    fill: white;
    stroke: none;
    text-anchor: middle;
}
#font-value {
    font-family: 'Days One';
    fill: white;
    stroke: none;
    text-anchor: middle;
}
#scroll-text {
    font-size: 100px;
}
#scroll-font {
    font-size: 21.5px;
}
</style>
<defs>
 <text id="scroll-value" >128</text>
 <rect id="scroller" height="80" width="300" />
 <text id="font-value">Shojumaru</text>
 <text id="font-index">81</text>
 <rect id="font-scroller" height="40" width="300" />
</defs>
<g id="controls" transform="scale(1)" >
<g id="scroll-container"  transform="translate(5,10) scale(1)">
    <use id="scroller-1" class="scroll" xlink:href="#scroller" />
    <use id="scroll-text" xlink:href="#scroll-value" x="150" y="75" />
</g>

<g id="scroll-container"  transform="translate(5,95) scale(1)">
    <use id="scroller-2" xlink:href="#font-scroller" />
    <use id="scroll-font" xlink:href="#font-value" x="150" y="26" />
</g>
</g>
<g id="text-group" transform="translate(10,255)">
<use id="text-display" xlink:href="#t2" x="10" y="10" />
</g>
</svg>

<svg id="svg3"
 xmlns:svg="http://www.w3.org/2000/svg"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink"
 shape-rendering="geometricPrecision"
 text-rendering="geometricPrecision"
 image-rendering="optimizeQuality"
 fill-rule="evenodd"
 clip-rule="evenodd"
 x="0"
 y="0"
 width="122"
 height="145"
 viewport="0 0 122 145">
<defs>
<path id="tt" d="M20.81 0
   c0.55 4.73 3.19 7.55 7.78 7.85
   v5.32c-2.66 0.26-4.99-0.61-7.70-2.25
   v9.95c0 12.64-13.78 16.59-19.32 7.53-3.56-5.83-1.38-16.06 10.04-16.47
   v5.61c-0.87 0.14-1.80 0.36-2.65 0.65-2.54 0.86-3.98 2.47-3.58 5.31 0.77 5.44 10.75 7.05 9.92-3.58
   V0.01h5.51z"/>
<rect id="r1" x="0" y="0" width="100%" height="95%" />
<rect id="tik-tok-bg-black" fill="#000" height="125" width="110" stroke="silver" stroke-width="3"/>
<rect id="tik-tok-bg-white" fill="#FFF" height="125" width="110" stroke="silver" stroke-width="3"/>
<g id="black">
    <use id="tt-logo-bg-white" x="0" y="0" width="48.59" height="33.63" fill="white" />
    <use id="tik-tok-black" xlink:href="#tt" x="0" y="0" width="48.59" height="33.63" />
</g>
<g id="white">
    <use id="tt-logo-bg-black" xlink:href="#tt" x="0" y="0" width="48.59" height="33.63" fill="black" />
    <use id="tik-tok-white" xlink:href="#tt" x="0" y="0" width="48.59" height="33.63" fill="white" />
</g>
</defs>
<g id="tt-logo" transform="translate(3,10)">
    <use id="tik-tok-background-2" xlink:href="#tik-tok-bg-black" />
    <g id="mg10" transform="translate(0 0)" filter="url(#tik-tok-filter-white)" >
        <use id="tik-tok-eight-note" xlink:href="#white" x="0.2em" y="0.2em" transform="scale(3.0)" />
    </g>
</g>
</svg>
</div>
<svg
    id="svg1"
    x="0"
    y="0"
    width="1000"
    height="700"
    viewport="0 0 1000 700"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    shape-rendering="geometricPrecision"
    text-rendering="geometricPrecision"
    image-rendering="optimizeQuality">
<defs>

<text id="textInput"></text>

<rect id="red-rect" fill="#F00" height="100%" width="100%" />
<rect id="anti-red-rect" fill="#0FF" height="100%" width="100%" />
<rect id="white-bg" fill="#FFF" height="100%" width="100%" />
<rect id="black-bg" fill="#000" height="100%" width="100%" />
<rect id="text-bg" fill="#000" height="100%" width="100%"/>

<filter id="tik-tok-filter-white"  x="-10%" y="-10%"  height="120%" width="120%">
  <feImage id="img-red" xlink:href="#red-rect" result="red-image" />
  <feComposite in="red-image" operator="in" in2="SourceGraphic" result="r1" />

  <feOffset id="white-filter-red-offset" in="r1" dx="2" dy="2" result="red-offset" >
    <animate id="white-filter-red-offset-dx" attributeName="dx" values="2; 0; -2; 0; 2; 0; -2; 0; 2" dur="0.2s" begin="svg1.click;svg1.mouseover;svg3.click;svg3.mouseover"
        repeatCount="4" />
    <animate id="white-filter-red-offset-dy" attributeName="dy" values="2; 0; -2; 0; 2; 0;  -2; 0; 2" dur="0.2s" begin="svg1.click;svg1.mouseover;svg3.click;svg3.mouseover"
        repeatCount="4" />
  </feOffset>
  <feImage id="img-anti-red" xlink:href="#anti-red-rect" result="anti-red-image" />

  <feComposite in="anti-red-image" operator="in" in2="SourceGraphic" result="r2" />
  <feOffset in="r2" dx="-2" dy="-2" result="anti-red-offset" >
    <animate id="white-filter-anti-red-offset-dx" attributeName="dx" values="-2; 0; 2; 0; 0; -2; 0; -2; 0; -2" dur="0.3s" begin="svg1.click;svg1.mouseover;svg3.click;svg3.mouseover"
        repeatCount="3" />
    <animate id="white-filter-anti-red-offset-dy" attributeName="dy" values="-2; 0; 0; 2; 0; -2; 0;  2; 0; -2" dur="0.3s" begin="svg1.click;svg1.mouseover;svg3.click;svg3.mouseover"
        repeatCount="3" />
  </feOffset>

  <feComposite in="red-offset" in2="anti-red-offset" operator="xor" result="offset-final" />

  <feComposite in="red-offset" in2="anti-red-offset" operator="in" result="in-offset" />
  <feImage id="img-white" xlink:href="#white-bg" result="white-image" />

  <feComposite in="white-image" in2="in-offset" operator="in" result="white-final" />

  <feComposite in="offset-final" in2="white-final" operator="over" result="final" />

</filter>

<filter id="tik-tok-filter-black" x="-10%" y="-10%"  height="120%" width="120%" >
    <feImage id="img-red" xlink:href="#red-rect" result="red-image" />
    <feComposite in="red-image" operator="in" in2="SourceGraphic" result="r1" />
  
    <feOffset in="r1" dx="2" dy="2" result="red-offset" >
        <animate id="black-filter-red-offset-dx" attributeName="dx" values="2; 0; -2; 0; -2; 0;  2; 0; 2" dur="0.2s" begin="svg1.click;svg1.mouseover;svg3.click;svg3.mouseover"
            repeatCount="4" />
        <animate id="black-filter-red-offset-dy" attributeName="dy" values="2; 0; -2; 0;  2; 0; -2; 0; 2" dur="0.2s" begin="svg1.click;svg1.mouseover;svg3.click;svg3.mouseover"
            repeatCount="4" />
    </feOffset>
    <feImage id="img-anti-red" xlink:href="#anti-red-rect" result="anti-red-image" />
  
    <feComposite in="anti-red-image" operator="in" in2="SourceGraphic" result="r2" />
    <feOffset in="r2" dx="-2" dy="-2" result="anti-red-offset" >
    <animate id="black-filter-anti-red-offset-dx" attributeName="dx" values="-2; 0; 2; 0; 0;  2; 0; -2; 0; -2" dur="0.3s" begin="svg1.click;svg1.mouseover;svg3.click;svg3.mouseover"
        repeatCount="3" />
    <animate id="black-filter-anti-red-offset-dy" attributeName="dy" values="-2; 0; 0; 2; 0; -2; 0;  2; 0; -2" dur="0.3s" begin="svg1.click;svg1.mouseover;svg3.click;svg3.mouseover"
        repeatCount="3" />
    </feOffset>
  
    <feComposite in="red-offset" in2="anti-red-offset" operator="xor" result="offset-final" />
  
    <feComposite in="red-offset" in2="anti-red-offset" operator="in" result="in-offset" />
    <feImage id="img-black" xlink:href="#black-bg" result="black-image" />
  
    <feComposite in="black-image" in2="in-offset" operator="in" result="black-final" />
  
    <feComposite in="offset-final" in2="black-final" operator="over" result="final" />
</filter>

<path id="tt" d="M20.81 0
   c0.55 4.73 3.19 7.55 7.78 7.85
   v5.32c-2.66 0.26-4.99-0.61-7.70-2.25
   v9.95c0 12.64-13.78 16.59-19.32 7.53-3.56-5.83-1.38-16.06 10.04-16.47
   v5.61c-0.87 0.14-1.80 0.36-2.65 0.65-2.54 0.86-3.98 2.47-3.58 5.31 0.77 5.44 10.75 7.05 9.92-3.58
   V0.01h5.51z"/>
<rect id="r1" x="0" y="0" width="100%" height="100%" />
<g id="black">
    <use id="bg-white" xlink:href="#tt" x="0" y="0" width="48.59" height="33.63" fill="white" />
    <use id="tik-tok-black" xlink:href="#tt" x="0" y="0" width="48.59" height="33.63" />
</g>
<g id="white">
    <use id="bg-black" xlink:href="#tt" x="0" y="0" width="48.59" height="33.63" fill="black" />
    <use id="tik-tok-white" xlink:href="#tt" x="0" y="0" width="48.59" height="33.63" fill="white" />
</g>
</defs>
<g id="base" >
    <use id="tik-tok-background" xlink:href="#black-bg" />
    <g id="mg4" transform="translate(0 0)" filter="url(#tik-tok-filter-white)" >
        <use id="m2-text" xlink:href="#textInput" x="0.2em" y="1.1em" 
            font-size="8em" />
    </g>
</g>
</svg>

<script>

var config = {
    textId: 'm2-text',
    svgId: 'svg2',
    formFontSizeId: 'fontSize',
    formFontFamilyId: 'fontFamily',
    textHref: '#m2-text',                //the hash is part of the href :(
    defaultFontIndex: 81,                 // Arial
    fontSize: 128,
    updateFontSize: false,
    fontFamily: 'Shojumaru',
    updateFontFamily: false,
}

var replaceStyleProperty = function(doc,refId,property,newValue) {
    let ele = document.getElementById(refId),
        styleCode = ele.getAttributeNS(null,"style"),
        styleStringArray = [],
        styleString = "",
        styleNVArray,
        styleProperty,
        styleList;

    if (styleCode) {

        styleList = styleCode.split(";");

        for (var i=0;i<styleList.length;i++) {
            styleNVArray = styleList[i].split(":")
            styleProperty = styleNVArray[0].trim().toLowerCase()
            if (styleProperty == property || styleProperty == "") {
                continue
            } else {
                styleStringArray[styleStringArray.length] = 
                    styleProperty + ": " + styleNVArray[1];
            }
        }
    }

    styleStringArray[styleStringArray.length] = property + ":" + newValue;
    styleString = styleStringArray.join(";");
    ele.setAttributeNS(null,"style",styleString);

    setTimeout("updateBackground('" + [...updateIds].join("','")  + "')",50);
}

var updateText = function (textId, inputId, textBgId, displayTextId) {
    let val = document.getElementById(inputId).value;
    document.getElementById(textId).innerHTML = val;

    setTimeout("updateBackground('" + [...updateIds].join("','")  + "')",50);
}

var onResizeText = function () {
    updateBackground(...updateIds);
}

var toggleWtoB = function (buttonId) {
    let value = $('#' + buttonId).val(),
        bgIds = [],
        fgIds = [],
        foreground,
        background,
        buttonText,
        newValue,
        href;

    console.log("current color=" + value);

    switch (value) {
    case "black": 
        bg1href    = "#black-bg"
        bg2href    = "#tik-tok-bg-black"
        background = "black";
        foreground = "white";
        buttonText = "W";
        newValue   = "white"
        break;
    case "white": 
    default:
        bg1href    = "#white-bg"
        bg2href    = "#tik-tok-bg-white"
        background = "white";
        foreground = "black";
        buttonText = "B";
        newValue   = "black";
        break;
    }


    let svgns = "http://www.w3.org/2000/svg",
        xlinkns ="http://www.w3.org/1999/xlink",
        doc = document,
        bg1 = doc.getElementById("tik-tok-background"),
        bg2 = doc.getElementById("tik-tok-background-2"),
        f1  = doc.getElementById("mg4"),
        f2  = doc.getElementById("mg10"),
        ttl = doc.getElementById("white-to-black");

    bg1.setAttributeNS(xlinkns,"href",bg1href);
    f1.setAttribute("filter",`url(#tik-tok-filter-${foreground})`);

    bg2.setAttributeNS(xlinkns,"href",bg2href);
    f2.setAttribute("filter",`url(#tik-tok-filter-${foreground})`);

    ttl.setAttribute("value",foreground);
    ttl.innerHTML = buttonText;

    console.log("new color=" + newValue);
}

var updateBackground = function (textId, inputId, textBgId, displayTextId,displayBoxId) {

    let bbox = document.getElementById(displayBoxId).getBBox(),
        textBg = document.getElementById(textBgId),
        svg = document.getElementById('svg1'),
        x = (bbox.x - 5).toFixed(2),
        y = (bbox.y - 5).toFixed(2),
        height = ((bbox.height + 50)*1).toFixed(2),
        width  = (bbox.width  + 50).toFixed(2);

    svg.setAttribute('x',x)
    svg.setAttribute('y',y)
    svg.setAttribute('height',height);
    svg.setAttribute('width',width);
    svg.setAttribute('viewport',[x,y,width,height].join(' '));
    textBg.setAttribute('width',width);
    textBg.setAttribute('height',width); // see if this helps
}

var textObj;
var updateIds = ['textInput','text-input','text-bg','m2-text','mg4']; // last=mg4

window.addEventListener('DOMContentLoaded', () => {
    textObj = document.getElementById('m2-text');
    textObj.onclick = onResizeText;
    updateText(...updateIds);
    init();
});
</script>
</body>
</html>