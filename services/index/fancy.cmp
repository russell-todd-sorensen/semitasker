set title "Index of $url"
set tail [file tail $url]
set shortTitle "Index of $url"
set mainCssFile [file join $dir "main.css"]
set mainCssExists [file exists $mainCssFile]
set title $url
if {$mainCssExists} {
set mainCss "main.css"
 } else {
set mainCss "/services/index/main-index.css"
}
append __string "<!DOCTYPE html>
<html lang='en-US'>
<head>
<meta charset='utf-8'>
<title>"

append __string $title
append __string "</title>
<link rel='stylesheet' type='text/css' href='"

append __string $mainCss
append __string "' media='all'>
<style type='text/css'>

table.dir \{
    margin: 10px;
}

table.dir th, 
table.files th \{
    text-align: left;
    background-color: silver;
    text-transform: capitalize;
    font-weight: bold;
    padding-right: 10px;
}

table.dir td,
table.files td \{
    padding-right: 30px;
}

table.dir td a \{
    padding-left: 30px;
}

.num \{
    text-align: right;
}
</style>

<script src='/js/jquery-3.1.1.js'></script>
 
</head>
<body>
<div class='nav'>
    <li><a href='/'>home page</a>"
set path "/"
foreach element $urlv {
append __string "&gt;</li>
    "
set path [append path $element "/"]
append __string "<li><a href='"

append __string $path
append __string "'>"

append __string $element
append __string "</a> 
"
}
append __string "
  <li>&nbsp;("

append __string $shortTitle)
append __string "</li>
</div>

<div id='content'>
    <h1 id='title'>"

append __string $shortTitle
append __string "</h1>
<table class='dir' cellspacing='0' cellpadding='2' border='0'>
 <tr>
  <th>directories</th>
  <th>last modified</th>
  <th>links</th>
  <th>type</th>
  <th>links to</th>
 </tr>
 
"
foreach dirname $dir_list {
set tail [file tail $dirname]
append __string [file lstat $dirname dirArray]
if {$dirArray(type) eq "link"} {
set dirArray(pointsTo) [file readlink $dirname]
 } else {
set dirArray(type) ""
set dirArray(pointsTo) ""
}
append __string "
  <tr>
   <td><a href='"

append __string $tail
append __string "/' class='dir'><nobr>"

append __string $tail
append __string "</nobr></a></td>
   <td><nobr>"
append __string [clock format $dirArray(mtime) -format "%Y-%m-%d %H:%M:%S"]
append __string "</nobr></td>
   <td class='num'>"

append __string $dirArray(nlink)
append __string "</td>
   <td class='num'>"

append __string $dirArray(type)
append __string "</td>
   <td>"

append __string $dirArray(pointsTo)
append __string "</td>
 </tr>
"
}
append __string "
 <tr>
  <th>files</th>
  <th>last modified</th>
  <th>exact</th>
  <th>size</th>
  <th>links to</th>
 </tr>
 
"
foreach obj $file_list {
set tail [file tail $obj]
append __string [file lstat $obj fileArray]
set extension [file extension $tail]
set file_extension [string trimleft $extension "."]
set size $fileArray(size)
set sizeOriginal $size
switch -glob -- "$file_extension" {
   "*~" - "*.o" {
   set a b
   }
   default {
   append __string "
  <tr>
   <td><a href='"

append __string ${tail}
append __string "' class='"

append __string $file_extension
append __string "'><nobr>"
append __string [string range $tail 0 50]
append __string "</nobr></a></td>
   <td><nobr>"
append __string [clock format $fileArray(mtime) -format "%Y-%m-%d %H:%M:%S"]
append __string "</nobr></td>
   <td class='num'>"

append __string $sizeOriginal
append __string "</td>
   <td class='num'><nobr>"
if {$size  <= 1024 } {
set size [format %3d $size]
append __string [string map {" " "&nbsp;"} $size]
append __string " &nbsp;B"

} elseif {($size / 1024.0) <= 1024} {
set size [expr {$size/1024}]
set size [format %3d $size]
append __string [string map {" " "&nbsp;"} $size]
append __string " KB"

} elseif {($size / (1024*1024)) <= 1024} {
append __string [expr {$size/(1024*1024)}]
append __string " MB"
}
append __string "</nobr></td>"
if {$fileArray(type) eq "link"} {
set fileArray(pointsTo) [file readlink $obj]
append __string "
            "
 } else {
set fileArray(pointsTo) ""
}
append __string "
   <td><nobr>"

append __string $fileArray(pointsTo)
append __string "</nobr></td>
  </tr>
        "
   }
}
}
append __string "</table>
</div>

<div class='bottom'>
 <hr>
 <address><a href='mailto:russell@highfivediet.com'>Russell Sorensen</a></address>

"
set script [info script]
set mtime [file mtime $script]
set clockTime [clock format $mtime -format "%+"]
append __string "

<!-- Created "

append __string $clockTime
append __string " -->

<span class='lastMod'>Last modified "

append __string $clockTime
append __string "</span>
 <div id='footer'>
  <div class='nav'>
   <li>\[<a href='..'>..</a>\] |</li>
   <li>\[<a href='.'>.</a>\]</li>
  </div>
 </div>
</div>
</body>
</html>"
