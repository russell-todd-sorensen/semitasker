<!DOCTYPE html>
<html lang="en_US">
<head>
<meta charset="utf-8" >
<title>Color Mixer</title>
<link rel="stylesheet" type="text/css" href="http://ic00408/css/log.css" media="all">
<link rel="stylesheet" type="text/css" href="http://ic00408/js/jQuery.UI.Combined.1.8.20.1/Content/Content/themes/base/jquery.ui.all.css">
<link rel="stylesheet" href="http://ic00408/css/green-form.css" >

<style>

svg {
    background-color: #000;
}

html, body {
    background-color: #000;
    padding: 0;
    margin: 0;
    border: 0;
}

.pointer {
    cursor: pointer;
}

#slider-box-1 {
    position: relative;
    display: none;
}

   

</style>
<!--<link rel="stylesheet" href="http://ic00408/css/box-model.css" >-->


<script src="http://ic00408/js/jquery-1.7.1.js"></script>
<script src="http://ic00408/js/jQuery.UI.Combined.1.8.20.1/Content/Scripts/jquery-ui-1.8.20.js"></script>
<script src="http://ic00408/js/d3.v3.js"></script>
<script src="http://ic00408/js/log-2.js"></script>
<script src="http://ic00408/js/data.js"></script>
<script src="http://ic00408/js/form-save-restore.js"></script>
<script src="http://ic00408/js/binary-hex-conversions.js"></script>
<script src="http://ic00408/js/example-library.js"></script>
<script src="http://ic00408/js/svg-transform.js"></script>
<script src="js/color-mixer-7.js" ></script>
<script>
// <![CDATA[ 


//var swatchCount = 3;
var linearGradientAttrs = {
	"gradientUnits": "objectBoundingBox",
	"color-interpolation": "sRGB"
}

var sliderInfo = {
	href: "#triangle-2",
	sliderId: function(index) {
		return "slider-" + index;
	},
	minX: 0,
	maxX: 255,
	fill: "#000",
	stroke: "#eee",
	strokeWidth: 1,
	sliderHeight: 10,
	sliderWidth: 10,
	sliderSpacing: 30,
	x: function () {
		return Math.ceil(this.maxX/2 - this.sliderWidth/2);
	},
	y: function (index) {
		return Math.ceil(sliderInfo.sliderStartY + sliderInfo.sliderHeight/2 + sliderInfo.sliderSpacing * index);
	},
	appTop: 40,
	sliderStartY: 20,
	swatchSpacing: 10,
};
var swatchRectAttrs = {
	x:0,
	y: -1 * sliderInfo.maxX,
	height:sliderInfo.maxX,
	width:sliderInfo.maxX,
	fill:'#808080',
	stroke:"none",
	strokeWidth: 0
};

var sliderRectAttrs = {
	x: 0,
	height: sliderInfo.sliderHeight,
	width: sliderInfo.maxX,
	fill: "url(#gradient-0)",
	stroke: "none"
};



var sliderHandleAttrs = {
	"x": sliderInfo.x(0),
	"y": sliderInfo.y(0),
	"minX": sliderInfo.minX,
	"maxX": sliderInfo.maxX,
	"xlink:href": sliderInfo.href,
	"fill": sliderInfo.fill,
	"stroke": sliderInfo.stroke,
	"stroke-width": sliderInfo.strokeWidth
};

swatches[swatches.length] = new Swatch('#swatch-1');
swatches[swatches.length] = new Swatch('#swatch-2');
swatches[swatches.length] = new Swatch('#swatch-3');
swatches[swatches.length] = new Swatch('#swatch-4');
swatches[swatches.length] = new Swatch('#swatch-5');

function writeSvg(appSelector) {
	var appId = appCounters.appIndex++;
	var app = d3.select(appSelector);
	var x = 0;
	var y = 0
	var width = (sliderInfo.maxX + 20 ) * 5;
	var height = sliderInfo.appTop + sliderInfo.maxX + sliderInfo.sliderSpacing * 3 + 30;
	var svg = app
				.append("svg")
				.attr("id", "swatch-app-" + appId)
				.attr({
					x: 0,
					y: 0,
					width: width,
					height: height,
					viewBox: "" + x + " " + y + " " + width + " " + height,
				});
		//		.attr("xmlns:xlink", "http://www.w3.org/1999/xlink");
 // var svgElement = document.getElementById("swatch-app-" + appId);
	
	var defs = svg
				.append("defs")
				.attr("id", "defs-" + appId);
	// make swatch area
	defs
				.append("path")
				//.attr({id: "triangle-2",d:"M 5 5 L 10 10 L 0 10 Z"});
				.attr({id: "triangle-2",d:"M 5 0 L 10 10 L 0 10 Z"});

  for (var i = 0; i<swatches.length; i++) {
		var swatchGroupSliders = [];
		var swatch = swatches[i];
		var swatchId = appCounters.swatchIndex++;
		var swatchGroup = svg
				.append("g")
				.attr({
						id: "color-" + swatchId,
						transform: "translate(" 
						+ parseFloat(10 + (sliderInfo.maxX + sliderInfo.swatchSpacing) * swatchId) + "," 
						+ parseInt(sliderInfo.maxX + sliderInfo.appTop) +")",
						class: "pointer"
				});
		swatchGroup
				.append("rect")
				.attr("id", swatch.name.substring(1))
				.attr(swatchRectAttrs);
				
		var sliderArray = [];
    var componentIndex = 0;
		for (var component in swatch.components) {
			var sliderId = sliders.length;
			sliderArray[sliderArray.length] = sliderId;
			sliders[sliderId] = new Slider(sliderId, swatch, swatch.components[component]);
			var slider = sliders[sliderId];
			var gradientName = generateGradientName();
			var gradientId = getGradientId(gradientName);
			var gradient = defs
				.append("linearGradient")
				.attr({id: gradientId})
				.attr(linearGradientAttrs);
				
			for (var j = 0; j < slider.stops.length; j++) {
				var stop = slider.stops[j];
				var stopName = generateStopName(stop);
				gradient
					.append("stop")
					.attr("offset", stop.offset)
					.attr("stop-opacity", "1.0")
					.attr("id", getStopId(stopName))
					.attr("stop-color",swatch.stopColor(stop.offset,swatch.components[component]));
				
			}
			swatchGroup
				.append("rect")
				.attr(sliderRectAttrs)
				.attr({
						"id": "r-" + sliderId,
						"width": slider.maxX,
						"height": 5,  // hard coded value !!!!!!
						"y": parseInt(sliderInfo.sliderStartY + sliderInfo.sliderSpacing * componentIndex),
						"fill": "url(" + gradientName + ")"
				});
			var index = componentIndex;
			swatchGroup
				.append("use")
				.attr(sliderHandleAttrs)
				.attr("y", sliderInfo.y(index))
				.attr("id", getSliderId(slider.name))
				;
			//swatchGroupSliders[swatchGroupSliders.length] = sliderId;
			$(slider.name)
				.bind('mousedown', sliders[sliderId], startMove);



			componentIndex++;
		}
		if (false) {
			app
				.append("input")
				.attr("id", "swatch-color-" + swatchId)
				.attr("name", "swatch-color-" + swatchId)
				.attr("size",3)
				.attr("onChange", "newColor(" + swatchId + ")")
				.style("position", "absolute")
				.style("top", "" + parseInt(parseInt(svg.attr("height")) + 20) + "px")
				.style("left", ""
					 +  parseFloat(10 + sliderInfo.maxX/3 + (sliderInfo.maxX + sliderInfo.swatchSpacing) * swatchId) + "px")
		}
		swatch.sliders = sliderArray;
	} // end iteration over swatches array
	
}

function writeSwatch(swatch) {

	
}

function writeLinearGradient(slider) {
	
	
}

$(document).ready(function(e) {
	writeSvg('#app-0');
});

// ]]>
</script>

</head>
<body>

<div id="app-0"></div>

</body>
</html>
