<!DOCTYPE HTML>
<html lang="en_US">
<head>
<meta charset="utf-8">
<base href="https://home.semitasker.com/" />
<title>Fractal Image Creation in JavaScript: B, W &amp; A</title>

<style>
body {
    background-color: black;
}
#svg {
    background-color: white;
    display: none;
}
#svg2 {
    background-color: white;
}
.A {
    font-size: 20px;
    font-family: Arial;
}
/* font-size values which look good 
    20px: but extra space
    30px: but too dense
    25px: almost perfect
    24.5px: very close
    24.1px: still looks close
    24px: perfect
    20.5px: very good low density
 */
#t1 {
    font-size: 20.5px;
    fill: black;
    font-family: Arial;
}

</style>

<script src="/js/jquery-1.7.1.js"></script>
<script src="/js/d3.v3.js"></script>
<script language="javascript">

var height = 50;
var width  = 63.65;
var points = new Array();
var numberOfPoints = 0;
var unitsOfWidth;
var unitsOfHeight;
function calculatePoints (config) {

    var cX = -0.1;
    var cY =  0.1;
    var captureBegin = {row:0,col:0}
    var captureEnd   = {row:10000,col:10000}
    var rect = {
        start: {
            x: -2.10,
            y: -1.22
        },
        end: {
            x: 0.60,
            y: 1.22
        }
    }

    if (config) {
        rect = config.rect
        captureBegin = config.captureBegin
        captureEnd   = config.captureEnd
        if (config.height) height = config.height
        if (config.width) width = config.width
    }

    unitsOfWidth = rect.end.x - rect.start.x;
    unitsOfHeight = rect.end.y - rect.start.y;
    var counter;
    var finite;
    var row,col;
    var id = 0;

    bigloop:
    for (var x = rect.start.x,col=0; x < rect.end.x; x+=1/width,col++) {
        for (var y = rect.start.y,row=0; y < rect.end.y ; y+=1/height,row++) {
            counter = 0;
            finite = true;
            newX = x;
            newY = y;
            tmpX = x;
            tmpY = y;
            cY = y;
            cX = x;
            while (counter < 256 && finite) {
                newY = cY +  2 * tmpX * tmpY;
                newX = cX + (-1 * tmpY * tmpY) + tmpX * tmpX;
                tmpX = newX;
                tmpY = newY;
                if (newX*newX+newY*newY > 256) {
                    finite = false;
                }
                counter++;
            }

            numberOfPoints++;

            if (row > captureEnd.row && col > captureEnd.col) break bigloop;
            if (row < captureBegin.row || row > captureEnd.row) continue
            if (col < captureBegin.col || col > captureEnd.col) continue
            if (counter == 256) continue; // This makes the m-set points empty

            points[points.length] = {cx:x,cy:y,counter:counter,finite:finite,row:row,col:col,id:id}
            id++;
        }
    }
}

var calcTileStartAndSize = function(svgId,config) {

    let startX,startY,endX,endY,height,width,addToX,addToY
    var point,point0,pointEnd
    for (var i = 0;i<points.length;i++) {
        point = points[i]
        if (point.row == config.captureBegin.row && point.col == config.captureBegin.col+1) {
            point0 = point
        } else
        if (point.row == config.captureEnd.row-2 && point.col == config.captureEnd.col-1) {
            pointEnd = point
            break;
        }
    }

    startX = point0.cx * config.factor;
    startY = point0.cy * config.factor;
    endX = pointEnd.cx * config.factor
    endY = pointEnd.cy * config.factor
    height = endY - startY
    width  = endX - startX
    addToX = 0 - startX
    addToY = 0 - startY
    console.log('startX=' + startX + ' startY='
        + startY + ', endX=' + endX + ', endY='
        + endY + ', height=' + height + ', width=' + width);
    var svg = $('#' + svgId)
    svg
        .attr('x',Math.ceil((startX+addToX)*1000)/1000)
        .attr('y',Math.ceil((startY+addToY)*1000)/1000)
        .attr('height',Math.ceil(height*1000)/1000)
        .attr('width',Math.ceil(width*1000)/1000)
        .attr('viewBox',[Math.ceil((startX+addToX)*1000)/1000,
            Math.ceil((startY+addToY)*1000)/1000,
            Math.ceil(width*1000)/1000,
            Math.ceil(height*1000)/1000].join(' '))

    config.startX=startX;
    config.startY=startY;
    config.endX=endX;
    config.endY=endY;
    config.height=height;
    config.width=width;
    config.addToX=addToX;
    config.addToY=addToY;

    return config
}

function addPoints(id, config) {

    var g = d3.select('#' + id);

    g.selectAll('use')
        .data(points)
        .enter()
        .append('use')
        .attr('id',function(d,i) {
            let val = 'p-' + d.id
            return val
        })
        .attr('href',config.textHref)
        .attr('class',function(d,i) {
            let val = 'A row-' + d.row + ' col-' + d.col
            return val
        })
        .attr('x', function(d,i) {
            let val = (Math.ceil((d.cx*config.factor + config.addToX)*1000)/1000);
            return val
        })
        .attr('y', function(d,i) {
            let val = (Math.ceil((d.cy*config.factor + config.addToY)*1000)/1000);
            return val
        })
        .attr('opacity', function(d,i) {
            return (1000-Math.ceil((Math.abs((255-20*d.counter)%255)/255)*1000))/1000;
        });
}

var config = {
    factor:1000,
    captureBegin: {col:2,row:2},
    captureEnd: {col:10,row:10},
    rect: {
        start: {
            x: -2.10,
            y: -1.22
        },
        end: {
            x: 0.60,
            y: 1.22
        }
    },
    height: 50,
    width: 63.65,
    textHref: '#t2',
};

$(document).ready(function() {
    calculatePoints(config);
    config = calcTileStartAndSize('svg2',config);
    addPoints('mPoints2',config)
});

</script>
<style>
#opacity-graph line.opacities {
    stroke: black;
    stroke-width: 1;
}
</style>

</head>
<body>
<div id="container">
<svg 
    id="svg2"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink">
<style>

#t2 {
    font-size: 48px;
    fill: black;
    font-family: Arial;
}

</style>
<defs>
 <text id="t2" fill="black" transform="skewX(0)" >A</text>
</defs>
<g id="mPoints2" transform="scale(1)" ></g>
</svg>
</div>
</body>
</html>
