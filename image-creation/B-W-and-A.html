<!DOCTYPE HTML>
<html lang="en_US">
<head>
<meta charset="utf-8">
<title>Fractal Image Creation in JavaScript</title>


<style>

#myCanvas {
    border: 1px solid black;
    border: none;
}

#container {
    border: 1px solid black;
    border: none;
}

#circle {
    fill: green;
}

.ellip {
    /*fill: url(#grad-1); */
    fill: black;
    font-size: .05px;
}

#t1 {
    font-size: .049px;
    font-family: Arial;
}

</style>

<style id="s2">

</style>
<script>
var Log = {
    Debug: function() {},
    Warning: function() {},
    Notice: function() {},
    Error: function() {},
}
</script>
<script src="/js/jquery-1.7.1.js"></script>
<script src="/js/d3.v3.js"></script>
<script src="/js/data.js"></script>
<script src="/js/form-save-restore.js"></script>
<script src="/js/binary-hex-conversions.js"></script>
<script src="/js/example-library.js"></script>
<script src="/js/svg-transform.js"></script>
<script language="javascript">

var height = 50;
var width = 60;
var points = new Array();

function calculatePoints () {

    var cX = -0.1;
    var cY =  0.1;
    var rect = {
        start: {
            x: -2.10,
            y: -1.22
        },
        end: {
            x: 0.60,
            y: 1.22
        }
    }

    var counter;
    var finite;
    for (var x = rect.start.x; x < rect.end.x; x+=1/width) {
        for (var y = rect.start.y; y < rect.end.y ; y+=1/height) {
            counter = 0;
            finite = true;
            newX = x;
            newY = y;
            tmpX = x;
            tmpY = y;
            cY = y;
            cX = x;
            while (counter < 256 && finite) {
                newY = cY +  2 * tmpX * tmpY;
                newX = cX + (-1 * tmpY * tmpY) + tmpX * tmpX;
                tmpX = newX;
                tmpY = newY;
                //if (Math.abs(newX*newY) > 5) {
                if (newX*newX+newY*newY > 256) {
                    finite = false;
                }
                counter++;
            }
            if (counter == 256) {
                continue; // This makes the set points empty
            }

            points[points.length] = {cx:x,cy:y,counter:counter,finite:finite}
            //Log.Notice('points.counter=' + points[points.length-1].counter +'points.cx=' + points[points.length-1].cx + 'points.cy=' + points[points.length-1].cy );
        }
    }

    console.log('-----point cx= = ' + points[points.length-1].cx + ' cy=' + points[points.length-1].cy );
}

function animatePoints(id) {
    var g = d3.select('#' + id);

    g.selectAll('circle')
        .data(points)
        .enter()
        .append('circle')
        .attr('r',0.5/height)
        .attr('class',function(d,i) {return 'c-' + d.counter})
        .attr('cx', function(d,i) {return d.cx})
        .attr('cy', function(d,i) {return d.cy})
        .attr('fill', function(d,i) {
            return 'rgb(' + Math.abs((255-40*d.counter)%255)
                + ',' + Math.abs((255-40*d.counter)%255)
                + ',' + Math.abs((255-40*d.counter)%255)
                + ')';
            }
        );
}

function animatePoints(id) {
    var g = d3.select('#' + id);

    g.selectAll('circle')
        .data(points)
        .enter()
        .append('circle')
        .attr('class',function(d,i) {return 'c-' + d.counter})
        .attr('r',0.5/height)
        .attr('cx', function(d,i) {return Math.round(d.cx*1000000)/1000000})
        .attr('cy', function(d,i) {return Math.round(d.cy*1000000)/1000000})
        .attr('opacity', function(d,i) {
            return 1-Math.round((Math.abs((255-20*d.counter)%255)/255)*1000)/1000;
            }
        );
}

function animatePoints(id) {
    var g = d3.select('#' + id);

    g.selectAll('ellipse')
        .data(points)
        .enter()
        .append('ellipse')
        .attr('class',function(d,i) {return 'c-' + d.counter})
        .attr('ry',0.5/height)
        .attr('rx',0.5/width)
        .attr('cx', function(d,i) {return Math.round(d.cx*1000000)/1000000})
        .attr('cy', function(d,i) {return Math.round(d.cy*1000000)/1000000})
        .attr('opacity', function(d,i) {
            return (1000-Math.round((Math.abs((255-20*d.counter)%255)/255)*1000))/1000;
            }
        );
}

function animatePoints(id) {
    var e = d3.select('#e1');

    var g = d3.select('#' + id);

    g.selectAll('ellipse')
        .data(points)
        .enter()
        .append('ellipse')
        .attr('ry',0.5/height)
        .attr('rx',0.5/width)
        .attr('class',function(d,i) {return 'ellip c-' + d.counter})
        .attr('cx', function(d,i) {return Math.round(d.cx*1000000)/1000000})
        .attr('cy', function(d,i) {return Math.round(d.cy*1000000)/1000000})
        .attr('opacity', function(d,i) {
            return (1000-Math.round((Math.abs((255-20*d.counter)%255)/255)*1000))/1000;
            }
        );
}

var i = 0;

function animatePoints2(id) {
    var g = d3.select('#' + id);
    var point;

    for (var r = 0; i<points.length || r<10000; i++,r++) {
        point = points[i];
        g.append('circle')
            .attr('r',0.5/height)
            .attr('cx',point.cx)
            .attr('opacity',(Math.round((1-point.counter/255)*1000))/1000);
    }
}


function animatePoints(id) {

    var g = d3.select('#' + id);

    g.selectAll('use')
        .data(points)
        .enter()
        .append('use')
        .attr('href','#t1')
        .attr('class',function(d,i) {return 'ellip c-' + d.counter})
        .attr('x', function(d,i) {return Math.round(d.cx*1000000)/1000000})
        .attr('y', function(d,i) {return Math.round(d.cy*1000000)/1000000})
        .attr('opacity', function(d,i) {
            return (1000-Math.round((Math.abs((255-20*d.counter)%255)/255)*1000))/1000;
            }
        );
}

function animateAgain(id) {
    var g = d3.select('#' + id);

    g.selectAll('circle')
        .data(points)
        .transition()
        .duration(4000)
        .delay(function (d,i) {
            return d.counter * 5;
            }
        )
        .ease('bounce')
        .attr('r', function (d,i) {
            d.r = d3.select(this).attr('r');
            return .5*d.r;
            }
        )
        .each('end', function (d,i) {
            var c = d3.select(this);
            d.r = c.attr('r');
            c.transition()
                .ease('bounce')
                .delay(d.counter * 40)
                .duration(4000)
                .attr('r', d.r*2);
            }
        );


}

$(document).ready(function() {
    calculatePoints();
    animatePoints('mPoints');
});
</script>


</head>
<body>
<div id="container">
<svg
    id="svg"
    x="-2500"
    y="-1500"
    height="5200"
    width="6000"
    viewBox="-4600 -2630 6000 5200"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink">

<animate attributeName="fill" begin="1s" steps="100" dur="20s"
         values="rgba(0,0,255,1);rbga(0,255,0,.3);rgba(255,0,0,.7);rgba(0,0,255,1)"
         repeatCount="indefinite" />
<defs>

<text id="t1" fill="black" >A</text>
</defs>

<!--<g id="mPoints" transform="translate(-0.45,-1.00) scale(.2) translate(-6.65,-4.45)" >-->
<g id="mPoints" transform=" scale(2120)" >
</g>

</svg>
</div>
</body>
</html>
